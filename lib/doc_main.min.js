window.W||(window.W=new Array,W.$modules=[]),W.$modules.push(function(a,b,c){function o(a){var b=document.createElement("a");return b.href=a,""==b.host&&(b.href=b.href),b}function E(a){if(a&&t&&v){var b=l[C];if(b){var d=(b[0],b[1].find(function(b){return b.keyId===a}));if(d){var e=d.path.split("/").pop(),f=b[0],g=b[3],h=g+"index.html?page="+encodeURIComponent(e);t.duals.src=h,v.duals.style={visibility:"hidden"},n.state={repo:g,repoDesc:f.repos_desc,category:B,doc:d,url:h},G(!0)}}}}function F(a){if(x&&y){var b,c=y.getHtmlNode();if(!(!c||(b=c.selectedIndex)<0||b>=l.length)){var d=l[b],e=d[1],f=d[3];d=d[0],n.state={repo:f,repoDesc:d.repos_desc,category:B,doc:null,url:""};var g;B==k?g=e:(g=[],e.forEach(function(a){a.category==B&&g.push(a)})),x.duals.data=g,a&&setTimeout(function(){E(a.keyId)},100)}}}function G(a){u&&h.eachComponent(u,function(b){var c,d=b.duals["data-show"];c="on_both"==d?"inline":!a==("on_list"==d)?"inline":"none",b.duals.style={display:c}})}function I(a,b){function m(){var a=l[C];return a?a[3]:""}function n(a){a.stopPropagation(),E(a.target.getAttribute("name"))}function o(a){return a.getYear()%100+"-"+(a.getMonth()+1)+"-"+a.getDate()+" "+a.getHours()+":"+a.getMinutes()}function p(a){a.stopPropagation();var b=a.target.getAttribute("name");if(b&&b!=B&&z){z.duals.cates.indexOf(b)<0||(B=b,F(),z.reRender())}}function q(a){a.stopPropagation();var b=a.target.getAttribute("name");if(b){var c=l[C];if(c){var d=c[1].find(function(a){return a.keyId===b});if(d){var e=c[3]+"$proxy.html?url=",f=d.path.split("/").pop();d.markdown?e+="output%2Fmark_editor.html":e+="output%2Fpage_editor.html",e+="&page="+encodeURIComponent(f),window.open(e,"_blank")}}}}if(a<=2)return void(1==a?(x=this,this.defineDual("data")):0==a&&(x=null));var c=this.state.parentWidth,d=void 0,e=c>=500?500:c>300?.9:270,f=this.state.data||[],g=f.map(function(a){var b=a.keyId,c=a.thumb,f=a.title||b;c?0!=c.search(H)&&(void 0===d&&(d=m()),c=d+c):c=a.markdown?"lib/res/pinp_blog.jpg":"lib/res/slideshow.jpg";var g=["P",{key:"thumb",klass:"self_center-start-end-stretch-default",width:150,height:120}];g=[g,["Img",{key:"img",name:b,src:c,style:{cursor:"pointer",width:"100%",height:"100%"},$onClick:n}]];var i=[["Panel",{key:"ctx",klass:"self_center-start-end-stretch-default p2-p3-p0-p1",width:-1,height:null,padding:[0,16,0,10],style:{textAlign:"left",color:"#444"}}],["P",{key:"titl",name:b,width:.9999,margin:0,$onMouseOver:function(a){this.duals.style={textDecoration:"underline"}},$onMouseOut:function(a){this.duals.style={textDecoration:"none"}},$onClick:n,style:{cursor:"pointer",fontWeight:"600"},"html.":f}]];a.desc&&a.desc.split("<br>").forEach(function(a,b){a&&i.push(["P",{key:"desc"+b,klass:"small-default-large",width:.9999,margin:[6,0,0,0],style:{color:"#555"},"html.":a}])});var j=[["P",{key:"info",klass:"small-default-large",width:.9999,margin:[8,0,2,0],style:{color:"#777"}}]];r&&0==C&&j.push(["Button",{key:"edit",name:b,style:{margin:"0 4px 0 0"},$onClick:q,"html.":"Edit"}]),a.category!=k&&a.category!=B&&j.push(["Span",{key:"cate",name:a.category,style:{margin:"0 4px 0 0",padding:"1px 3px",border:"1px solid #faa",borderRadius:"3px",cursor:"default"},$onMouseOver:function(a){this.duals.style={backgroundColor:"#fff4f4"}},$onMouseOut:function(a){this.duals.style={backgroundColor:""}},$onClick:p,"html.":a.category}]),j.push(["Span",{key:"modi","html.":o(new Date(a.modify_at)),title:a.path.split("/").pop(),style:{cursor:"default"}}]),i.push(j);var l=[["Panel",{key:b,width:e,height:null,padding:[6,0,6,0]}],g,i];return h.loadElement(l)}),i=c>=1e3?Math.floor(c/500):1;if(i>=2)for(var j=g.length%i;j>0;)j-=1,g.push(h.loadElement(["Panel",{key:"_pad"+j,width:e,height:120}]));h.setChildren(this,g)}function J(a,b){if(a<=2)return void(1==a?(z=this,this.firstShow=!0,this.setEvent({$onClick:function(a){var b=a.target;if("BUTTON"==b.nodeName){var c=b.getAttribute("name");c&&(v&&(v.duals.style={visibility:"visible"}),n.state.doc=null,n.state.url="",G(!1),B!=c&&(B=c,D&&D.setItem("lastCate",c),F(),this.reRender()))}}}),this.defineDual("cates",function(a,b){var c=this.state.cates;c.length||c.push(k);var d=null;if(this.firstShow){if(this.firstShow=!1,s.doc){var e=decodeURIComponent(s.doc),f=e.split("/");e=f.pop();var g=e.split(".");g.length>=2&&g.pop(),g.push("txt"),0==f.length&&f.push("md"),f.push(g.join(".")),e=f.join("/");d=l[0][1].find(function(a){return a.path===e}),d&&(B=d.category)}d||(s.cate?B=decodeURIComponent(s.cate):D&&(B=D.getItem("lastCate")||k))}c.indexOf(B)<0&&(B=c[c.length-1]),setTimeout(F,0,d)},[k])):0==a&&(z=null));h.setChildren(this,this.state.cates.map(function(a,b){var c={key:"cate"+b,"html.":a,name:a,style:{color:a==B?"#c00":"#444"}};return h.loadElement(["Button",c])}))}function K(a,b,c){var d=(a.doc_list||[]).slice(0);d.forEach(function(a){var b=(a.tag||"").split("."),c=b[0],d=k;b.length>=2&&(d=b[1]);var e=a.path.split("/").pop(),f=e.split(".");f.length>1&&f.pop();var g=f.join("_");a.category=d,a.sortName=c+g,a.keyId=g.replace(/-/g,"_")});for(var e=d.length-1;e>=0;e--){d[e].hidden&&d.splice(e,1)}d.sort(function(a,b){return a.sortName>b.sortName?-1:1}),l.push([a,d,b,c])}function M(a,b){function d(a){L+=1,a.forEach(function(a){var b=a[0],c=a[1];if(b){"/"!=b.slice(-1)&&(b+="/");var d=b,e=L;b+="config.json",h.ajax({type:"GET",url:b,dataType:"json",success:function(a,b,g){L===e&&(c||(c=a.repos_desc||a.repos_name),K(a,c,d),setTimeout(f,0))},error:function(a,c){L===e&&console.log("error: load config ("+b+") failed")}})}})}function e(){var a,b=y.getHtmlNode();if(b&&!((a=b.selectedIndex)<0)&&z&&C!=a){if(a>=l.length)return;var c=[k],d=l[a];d[0];d[1].forEach(function(a){c.indexOf(a.category)<0&&c.unshift(a.category)}),B=k,C=a,z.duals.cates=c}}function f(){if(y){var a=l.map(function(a){return a[2]});y.duals.data=a,!r&&0==C&&l.length>=2&&0==l[0][1].length&&l[1][1].length>0&&setTimeout(function(){var a=y.getHtmlNode();!a||a.selectedIndex<0||(a.selectedIndex=1,e())},300)}}if(a<=2)return void(1==a?(y=this,this.setEvent({$onChange:function(a){e()}})):2==a?(e(),d(l[0][0].imported_repos||[])):0==a&&(y=null));var c=this.state.data||[];h.setChildren(this,c.map(function(a,b){var c="repo_"+b;return h.loadElement(["Option",{key:c,value:c,"html.":a}])}))}function N(a,b){if(a<=2)if(1==a){A=this;var c=150,d=8,e=[["Div",{key:"menu",klass:"noselect-txt",width:c,padding:2,borderWidth:1,style:{fontSize:"14px",borderColor:"#eee",borderRadius:"4px",boxShadow:"-2px 8px 4px rgba(0,0,0,0.1)"}}]];n.menus.forEach(function(a,b){e.push(["P",{key:"menu"+b,width:.9999,height:20,margin:0,padding:[0,8,0,8],style:{overflow:"hidden",cursor:"default"},"html.":a.title,$onMouseOver:function(a){this.duals.style={backgroundColor:"blue",color:"#fff"}},$onMouseOut:function(a){this.duals.style={backgroundColor:"",color:""}},$onClick:a.onClick}]),d+=20}),this.menuBody=h.loadElement(e),this.menuFrame=h.loadElement(["Div",{width:c,height:d}]),this.setEvent({$onMouseOver:function(a){this.duals.style={backgroundColor:"#e4e4e4"}},$onMouseOut:function(a){this.duals.style={backgroundColor:"transparent"}},$onClick:function(a){var b=a.clientX,e=a.clientY;h.popWin.showWindow(this.menuBody,{left:b+2,top:e+2,width:c,height:d,maskColor:"transparent",bodyStyle:{backgroundColor:"#f4f4f4"},frame:{left:b+2,top:e+2,width:c,height:d},frameElement:this.menuFrame})}})}else 2==a?setTimeout(function(){A&&r&&(A.duals.style={display:"block"})},300):0==a&&(A=null);else;}function O(a,b,c){function e(){if(this.config={},window.localStorage){this.canSave=!0;var a=localStorage.getItem(d);if(a)try{this.config=JSON.parse(a)}catch(a){}}else this.canSave=!1}var d="pinp/blogs/cfg";e.prototype={setItem:function(a,b){this.config[a]=b,this.canSave&&localStorage.setItem(d,JSON.stringify(this.config))},getItem:function(a){return this.config[a]}},D=new e,r=a.isLocal,s=b,h.ajax({type:"GET",url:"config.json",dataType:"json",success:function(a,b,d){m(a,c)},error:function(a,b){var d="error: load config.json failed";console.log(d),alert(d),c&&c()}})}function Q(a){try{"object"==typeof a&&a.data?(a=a.data,a=JSON.parse(a.slice(14))):a=null}catch(b){a=null,console.log(b)}if("object"==typeof a){var b;if("markScroll"==a.method){if(w){var c=a.param[0],d=c<=6?"flex":P<c?"none":"flex";P=c,w.duals.style={display:d}}}else if("enterPage"==a.method){if(w){var e=a.param[0];w.duals.style={display:0==e?"flex":"none"}}}else(b=n.msgHandle[a.method])&&b(a)}}var d=a("react"),f=(a("react-dom"),a("shadow-widget")),g=f.$main,h=f.$utils,k=(f.$ex,f.$idSetter,"All"),l=[],m=function(a,b){},n={state:{repo:"",repoDesc:"",category:k,doc:null,url:""}};n.instantTool=[{title:"Share document",show:"on_both",icon:"output/res/share.png",onClick:function(a){var b,c,d="",e=n.state,f=e.doc;f?(b=f.title||f.path.split("/").pop(),sPath=f.path,0==sPath.indexOf("md/")&&(sPath=sPath.slice(3)),c="index.html?doc="+encodeURIComponent(sPath),d="index.html?page="+encodeURIComponent(sPath)):(b=e.repoDesc||"Blog",c=e.category==k?"index.html":"index.html?cate="+encodeURIComponent(e.category)),c=o(e.repo+c).href;var g="Title: "+b+"\n\nURL: "+c;d&&(g+="\n\nOr: "+o(e.repo+d).href),alert(g)}}],n.menus=[{title:"Create document",onClick:function(a){h.popWin.popWindow();var b=h.loadElement(["Iframe",{key:"frame",frameBorder:"0",width:.9999,height:.9999,src:"output/menu_create.html"}]);h.popWin.showWindow(b,{width:.8,height:.9,manualClose:!0})}},{title:"Config documents",onClick:function(a){h.popWin.popWindow();var b=h.loadElement(["Iframe",{key:"frame",frameBorder:"0",width:.9999,height:.9999,src:"output/menu_config.html"}]);h.popWin.showWindow(b,{width:.8,height:.9,manualClose:!0})}}],n.msgHandle={configDone:function(a){var b=a.param[0],c=a.param[1];h.popWin.popWindow(),c&&l.length&&(b&&l[0][0].last_modify===c.last_modify||(b&&alert("The page will reload since global configure is changed by other APP."),setTimeout(m,0,c)))}};var p=/<\!-- SLIDE PAGES V[.0-9]+, DO NOT CHANGE THIS LINE. -->/,q=null;g.$$onLoad.push(function(d){function h(){var a=document.body.getAttribute("data-loading");return"string"!=typeof a||0===parseInt(a)}function i(a){if(e>180)return void console.log("load shadow-widget system timeout");e+=1,setTimeout(function(){h()?setTimeout(j,100):i()},a||500)}function j(){if(f.$modules.length){for(var e=g.$$onLoad.length;f.$modules.length;){var h=f.$modules.shift();"function"==typeof h&&h.call(c,a,b,c)}for(var h,i=e;h=g.$$onLoad[i];i++)g.$$onLoading.push(h)}d()}if(q)return d();var e=0;i(100)});var r=!1,s=null,t=null,u=null,v=null,w=null,x=null,y=null,z=null,A=null,B=k,C=-1,D=null,H=/^\/|http:|https:/,L=0,m=function(a,b){function e(){K(a,d,"");var e=[["Panel",{key:"doc",width:.9999,height:.9999,klass:"col-reverse",style:{backgroundColor:"#fff"}}],["Iframe",{key:"preview",frameBorder:0,width:.9999,height:.9999,src:""}]],f=[["Panel",{key:"list",klass:"col-reverse",left:0,top:0,width:.9999,height:.9999,borderWidth:[0,0,1,0],style:{position:"absolute"}}],["Panel",{key:"gap",width:.9999,height:36}],["Panel",{key:"items",width:.9999,height:-1,klass:"justify_center-end-default auto-hidden-visible",style:{backgroundColor:"#fff"},$id__:I}]],g=[["Panel",{key:"tool",klass:"nowrap-default-wrap_reverse",width:.9999,height:36,borderWidth:[0,0,1,0],style:{position:"absolute",backgroundColor:"#d8d8d8",borderColor:"#ccc"}}],["Div",{key:"menu",width:40,height:.9999,title:"Main menu",$id__:N,style:{display:"none",background:"url(output/res/menu.png) no-repeat center"}}],[["Panel",{key:"cate",width:-1,height:.9999}],["P",{key:"list",klass:"right-default-align_center",width:.9999,margin:[4,0,0,0],$id__:J}]],[["P",{key:"repo",klass:"align_center-right-default",margin:[4,0,0,0],width:110,height:.9999}],["Select",{key:"sel","dual-data":[d],$id__:M}]]],i=n.instantTool||[];if(i.length){var j=i.map(function(a,b){return["Img",{key:"tool"+b,src:a.icon,title:a.title||"",style:{width:"20px",height:"20px"},"data-show":a.show||"on_both",$onClick:a.onClick,$onMouseOver:function(a){this.duals.style={opacity:"0.5"}},$onMouseOut:function(a){this.duals.style={opacity:"1"}}}]});j.unshift(["P",{key:"inst",klass:"align_center-right-default",width:20*i.length+20,height:.9999}]),g.splice(3,0,j)}c.setChild(h.loadElement(e),h.loadElement(f),h.loadElement(g),function(a){w=c.componentOf("tool"),t=c.componentOf("doc.preview"),v=c.componentOf("list"),i.length&&(u=w.componentOf("inst"),G(!1)),b&&b()})}var c=f.W(".body").component,d=a.repos_desc||a.repos_name;l.length?(l.splice(0),B=k,C=-1,!b&&D&&D.setItem("lastCate",k),c.setChild("-doc","-list","-tool",function(a){w=null,t=null,v=null,u=null,e()})):e()},P=0;g.$$onLoad.push(function(a){function e(a){return{isFile:"file:"==a.protocol,isLocal:"localhost"==a.hostname||"127.0.0.1"==a.hostname,fileName:a.pathname.split("/").pop()||"index.html"}}function i(a){var b={};return a.split("&").forEach(function(a){if(a){var c=a.split("="),d=c[0].trim();d&&(b[d]=(c[1]||"").trim())}}),b}function j(a,b){function i(a){var c,d="",e=a.split(p);e.length>=2?(e.length>2&&console.log("warning: PINP document format error!"),c=e[0],d=e[1].trim()):c=a,b(!0,c,d)}var c=document.body.querySelector("#pinp-mrkdn > code");if(c&&"PRE"==c.parentNode.nodeName)i(c.innerHTML);else{var d=a.fileName.split("/"),e=d.pop();0==d.length&&d.push("md");var f=e.split(".");f.length>=2&&f.pop(),f.push("txt"),d.push(f.join("."));var g=d.join("/");h.ajax({type:"GET",url:g,dataType:"text",success:function(a,b,c){i(a)},error:function(a,c){var d="error: load "+g+" failed";console.log(d),alert(d),b(!1,"","")}})}}function k(a,b,c,e){var g=q.scanNodeAttr(b,"",0);if(!g||"ScenePage"!==g[0])return null;var h=g[1],i=h.key;i&&"string"==typeof i||(i="auto"+(a.comps.length+a.removeNum+e)),h["keyid."]=h.key=i;var j=f.$staticNodes.length,k=q.scanPreCode(b,"ScenePage["+e+"]",!0);return f.$staticNodes.length>j&&(h["hasStatic."]=!0),k.unshift(c,h),d.createElement.apply(null,k)}function l(){function i(a){var b=/\$=['"]\.pinp\.doc_info\.title["']/m,c=b.exec(a);if(c){var e,f=a.indexOf(">",c.index);if(f>0&&(e=a.indexOf("<",f))>0)return a.slice(f+1,e).trim()}return""}var d=null,e=window.parent.window&&window.parent.window!==window;j(b,function(b,c,j){if(!b)return a();var l=i(c+"\n"+j);l&&(document.title=l);var m=f.W(".body").component,n=[];if(j){var o=h.getWTC("ScenePage"),p=o.ScenePage,r="",s=[],t=document.createElement("div");t.innerHTML=j;for(var v,u=0;v=t.children[u];u++)if("DIV"==v.nodeName){var w=k(m.$gui,v,p,n.length);if(w){var x=(w.props["keyid."]||"")+"";!w.props.noShow&&x&&s.push(x),0==n.length&&(r=x),n.push(w)}}if(n.length){if(r&&0!=s.length)return e&&s.length>0&&document.body.addEventListener("slideenter",function(a){var b=a.pageKey,c=a.pageIndex,d=h.pageCtrl.isFirstEnter(a.target),e="[PROJECT_NAME]"+JSON.stringify({method:"enterPage",param:[c,b,d]});window.parent.window.postMessage(e,"*")},!1),n.push(function(b){function l(a,b){d=a,setTimeout(function(){a.duals["html."]=b},300)}function n(a){var b=[];s.forEach(function(a){var c=m.componentOf(a);c&&b.push([a,c])}),h.pageCtrl&&h.pageCtrl.destory(),h.pageCtrl=new q.pageCtrl_(b),d&&1==b.length&&(h.pageCtrl.config={size:"0x0",noSidebar:1,noKeypress:1,noFrame:1,noTrans:1},m.listen("innerSize",function(a,b){f.isHooked&&(f.duals.width=a[0],f.duals.height=a[1])})),a()}var f=null;if(s[0]==r){f=m.componentOf(r);var i=c&&(c.length>24||c.trim());if(f&&i){var j=f.componentOf("marked_doc");if(j)j.props["marked."]?l(j,c):console.log("error: marked_doc should be MarkedDiv"),g.$$onLoading.push(n),a();else{var k={key:"marked_doc",klass:"auto-hidden-visible",padding:[24,6,6,6],margin:0,left:-.5,top:-.5,width:.9999,height:.9999};e&&(k.$onScroll=function(a){var b="[PROJECT_NAME]"+JSON.stringify({method:"markScroll",param:[a.target.scrollTop]});window.parent.window.postMessage(b,"*")}),f.setChild(h.loadElement(["MarkedDiv",k]),function(b){j=f.componentOf("marked_doc"),j&&l(j,c),g.$$onLoading.push(n),a()})}return}}g.$$onLoading.push(n),a()}),void m.setChild.apply(m,n);n=[]}}var w=h.loadElement(["MarkedDiv",{key:"marked_doc",width:.9999,height:.9999,margin:0,padding:[24,6,6,6],klass:"auto-hidden-visible",style:{backgroundColor:"#fff"}}]);m.setChild(w,function(a){var b=m.componentOf("marked_doc");b&&(b.duals["html."]=c)}),a()}),c.page&&window.addEventListener("message",function(a){try{"object"==typeof a&&a.data?(a=a.data,a=JSON.parse(a.slice(14))):a=null}catch(b){a=null,console.log(b)}if("object"==typeof a&&"updateMark"==a.method){var b=a.param[0];if(d&&"string"==typeof b){var c=-1,e=!1,f=d.getHtmlNode();f&&(c=f.scrollTop)>6&&c+f.clientHeight>=f.scrollHeight-20&&(e=!0),d.duals["html."]=b,c>10&&setTimeout(function(){f.scrollTop=e?Math.max(0,f.scrollHeight-f.clientHeight):c},800)}}})}if(q||f.__design__)return a();q=f.$creator,window.addEventListener("message",Q,!1);var b=e(window.location),c=i(window.location.search.slice(1));return c.page&&(b.fileName=decodeURIComponent(c.page)),"index.html"!=b.fileName?l():O(b,c,a)})});