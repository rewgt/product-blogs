window.W||(window.W=new Array,W.$modules=[]),W.$modules.push(function(e,t,n){function o(e){var t=document.createElement("a");return t.href=e,""==t.host&&(t.href=t.href),t}function i(e){if(e&&E&&O){var t=w[D];if(t){t[0];var n=t[1].find(function(t){return t.keyId===e});if(n){var o=n.path.split("/").pop(),i=t[0],a=t[3],r=a+"index.html?page="+encodeURIComponent(o);E.duals.src=r,O.duals.style={visibility:"hidden"},b.state={repo:a,repoDesc:i.repos_desc,category:W,doc:n,url:r},l(!0)}}}}function a(e){if(I&&T){var t,n=T.getHtmlNode();if(!(!n||(t=n.selectedIndex)<0||t>=w.length)){var o=w[t],a=o[1],l=o[3];o=o[0],b.state={repo:l,repoDesc:o.repos_desc,category:W,doc:null,url:""};var r;W==v?r=a:(r=[],a.forEach(function(e){e.category==W&&r.push(e)})),I.duals.data=r,e&&setTimeout(function(){i(e.keyId)},100)}}}function l(e){P&&y.eachComponent(P,function(t){var n,o=t.duals["data-show"];n="on_both"==o?"inline":!e==("on_list"==o)?"inline":"none",t.duals.style={display:n}})}function r(e,t){function n(){var e=w[D];return e?e[3]:""}function o(e){e.stopPropagation(),i(e.target.getAttribute("name"))}function l(e){return e.getYear()%100+"-"+(e.getMonth()+1)+"-"+e.getDate()+" "+e.getHours()+":"+e.getMinutes()}function r(e){e.stopPropagation();var t=e.target.getAttribute("name");t&&t!=W&&N&&(N.duals.cates.indexOf(t)<0||(W=t,a(),N.reRender()))}function s(e){e.stopPropagation();var t=e.target.getAttribute("name");if(t){var n=w[D];if(n){var o=n[1].find(function(e){return e.keyId===t});if(o){var i=n[3]+"$proxy.html?url=",a=o.path.split("/").pop();o.markdown?i+="output%2Fmark_editor.html":i+="output%2Fpage_editor.html",i+="&page="+encodeURIComponent(a),window.open(i,"_blank")}}}}if(e<=2)1==e?(I=this,this.defineDual("data")):0==e&&(I=null);else{var d=this.state.parentWidth,c=void 0,u=d>=500?500:d>300?.9:270,h=(this.state.data||[]).map(function(e){var t=e.keyId,i=e.thumb,a=e.title||t;i?0!=i.search(L)&&(void 0===c&&(c=n()),i=c+i):i=e.markdown?"lib/res/pinp_blog.jpg":"lib/res/slideshow.jpg";var d=["P",{key:"thumb",klass:"self_center-start-end-stretch-default",width:150,height:120}];d=[d,["Img",{key:"img",name:t,src:i,style:{cursor:"pointer",width:"100%",height:"100%"},$onClick:o}]];var h=[["Panel",{key:"ctx",klass:"self_center-start-end-stretch-default p2-p3-p0-p1",width:-1,height:null,padding:[0,16,0,10],style:{textAlign:"left",color:"#444"}}],["P",{key:"titl",name:t,width:.9999,margin:0,$onMouseOver:function(e){this.duals.style={textDecoration:"underline"}},$onMouseOut:function(e){this.duals.style={textDecoration:"none"}},$onClick:o,style:{cursor:"pointer",fontWeight:"600"},"html.":a}]];e.desc&&e.desc.split("<br>").forEach(function(e,t){e&&h.push(["P",{key:"desc"+t,klass:"small-default-large",width:.9999,margin:[6,0,0,0],style:{color:"#555"},"html.":e}])});var f=[["P",{key:"info",klass:"small-default-large",width:.9999,margin:[8,0,2,0],style:{color:"#777"}}]];_&&0==D&&f.push(["Button",{key:"edit",name:t,style:{margin:"0 4px 0 0"},$onClick:s,"html.":"Edit"}]),e.category!=v&&e.category!=W&&f.push(["Span",{key:"cate",name:e.category,style:{margin:"0 4px 0 0",padding:"1px 3px",border:"1px solid #faa",borderRadius:"3px",cursor:"default"},$onMouseOver:function(e){this.duals.style={backgroundColor:"#fff4f4"}},$onMouseOut:function(e){this.duals.style={backgroundColor:""}},$onClick:r,"html.":e.category}]),f.push(["Span",{key:"modi","html.":l(new Date(e.modify_at)),title:e.path.split("/").pop(),style:{cursor:"default"}}]),h.push(f);var p=[["Panel",{key:t,width:u,height:null,padding:[6,0,6,0]}],d,h];return y.loadElement(p)}),f=d>=1e3?Math.floor(d/500):1;if(f>=2)for(var p=h.length%f;p>0;)p-=1,h.push(y.loadElement(["Panel",{key:"_pad"+p,width:u,height:120}]));y.setChildren(this,h)}}function s(e,t){e<=2?1==e?(N=this,this.firstShow=!0,this.setEvent({$onClick:function(e){var t=e.target;if("BUTTON"==t.nodeName){var n=t.getAttribute("name");n&&(O&&(O.duals.style={visibility:"visible"}),b.state.doc=null,b.state.url="",l(!1),W!=n&&(W=n,j&&j.setItem("lastCate",n),a(),this.reRender()))}}}),this.defineDual("cates",function(e,t){var n=this.state.cates;n.length||n.push(v);var o=null;if(this.firstShow){if(this.firstShow=!1,x.doc){var i=decodeURIComponent(x.doc),l=i.split("/"),r=(i=l.pop()).split(".");r.length>=2&&r.pop(),r.push("txt"),0==l.length&&l.push("md"),l.push(r.join(".")),i=l.join("/"),(o=w[0][1].find(function(e){return e.path===i}))&&(W=o.category)}o||(x.cate?W=decodeURIComponent(x.cate):j&&(W=j.getItem("lastCate")||v))}n.indexOf(W)<0&&(W=n[n.length-1]),setTimeout(a,0,o)},[v])):0==e&&(N=null):y.setChildren(this,this.state.cates.map(function(e,t){var n={key:"cate"+t,"html.":e,name:e,style:{color:e==W?"#c00":"#444"}};return y.loadElement(["Button",n])}))}function d(e,t,n){var o=(e.doc_list||[]).slice(0);o.forEach(function(e){var t=(e.tag||"").split("."),n=t[0],o=v;t.length>=2&&(o=t[1]);var i=e.path.split("/").pop().split(".");i.length>1&&i.pop();var a=i.join("_");e.category=o,e.sortName=n+a,e.keyId=a.replace(/-/g,"_")});for(var i=o.length-1;i>=0;i--)o[i].hidden&&o.splice(i,1);o.sort(function(e,t){return e.sortName>t.sortName?-1:1}),w.push([e,o,t,n])}function c(e,t){function n(){var e,t=T.getHtmlNode();if(t&&!((e=t.selectedIndex)<0)&&N&&D!=e){if(e>=w.length)return;var n=[v],o=w[e];o[0];o[1].forEach(function(e){n.indexOf(e.category)<0&&n.unshift(e.category)}),W=v,D=e,N.duals.cates=n}}function o(){if(T){var e=w.map(function(e){return e[2]});T.duals.data=e,!_&&0==D&&w.length>=2&&0==w[0][1].length&&w[1][1].length>0&&setTimeout(function(){var e=T.getHtmlNode();!e||e.selectedIndex<0||(e.selectedIndex=1,n())},300)}}if(e<=2)1==e?(T=this,this.setEvent({$onChange:function(e){n()}})):2==e?(n(),function(e){A+=1,e.forEach(function(e){var t=e[0],n=e[1];if(t){"/"!=t.slice(-1)&&(t+="/");var i=t,a=A;t+="config.json",y.ajax({type:"GET",url:t,dataType:"json",success:function(e,t,l){A===a&&(n||(n=e.repos_desc||e.repos_name),d(e,n,i),setTimeout(o,0))},error:function(e,n){A===a&&console.log("error: load config ("+t+") failed")}})}})}(w[0][0].imported_repos||[])):0==e&&(T=null);else{var i=this.state.data||[];y.setChildren(this,i.map(function(e,t){var n="repo_"+t;return y.loadElement(["Option",{key:n,value:n,"html.":e}])}))}}function u(e,t){if(e<=2)if(1==e){M=this;var n=8,o=[["Div",{key:"menu",klass:"noselect-txt",width:150,padding:2,borderWidth:1,style:{fontSize:"14px",borderColor:"#eee",borderRadius:"4px",boxShadow:"-2px 8px 4px rgba(0,0,0,0.1)"}}]];b.menus.forEach(function(e,t){o.push(["P",{key:"menu"+t,width:.9999,height:20,margin:0,padding:[0,8,0,8],style:{overflow:"hidden",cursor:"default"},"html.":e.title,$onMouseOver:function(e){this.duals.style={backgroundColor:"blue",color:"#fff"}},$onMouseOut:function(e){this.duals.style={backgroundColor:"",color:""}},$onClick:e.onClick}]),n+=20}),this.menuBody=y.loadElement(o),this.menuFrame=y.loadElement(["Div",{width:150,height:n}]),this.setEvent({$onMouseOver:function(e){this.duals.style={backgroundColor:"#e4e4e4"}},$onMouseOut:function(e){this.duals.style={backgroundColor:"transparent"}},$onClick:function(e){var t=e.clientX,o=e.clientY;y.popWin.showWindow(this.menuBody,{left:t+2,top:o+2,width:150,height:n,maskColor:"transparent",bodyStyle:{backgroundColor:"#f4f4f4"},frame:{left:t+2,top:o+2,width:150,height:n},frameElement:this.menuFrame})}})}else 2==e?setTimeout(function(){M&&_&&(M.duals.style={display:"block"})},300):0==e&&(M=null);else;}function h(e,t,n){function o(){if(this.config={},window.localStorage){this.canSave=!0;var e=localStorage.getItem(i);if(e)try{this.config=JSON.parse(e)}catch(e){}}else this.canSave=!1}var i="pinp/blogs/cfg";o.prototype={setItem:function(e,t){this.config[e]=t,this.canSave&&localStorage.setItem(i,JSON.stringify(this.config))},getItem:function(e){return this.config[e]}},j=new o,_=e.isLocal,x=t,y.ajax({type:"GET",url:"config.json",dataType:"json",success:function(e,t,o){k(e,n)},error:function(e,t){var o="error: load config.json failed";console.log(o),alert(o),n&&n()}})}function f(e){try{"object"==typeof e&&e.data?(e=e.data,e=JSON.parse(e.slice(14))):e=null}catch(t){e=null,console.log(t)}if("object"==typeof e){var t;if("markScroll"==e.method){if(S){var n=e.param[0],o=n<=6?"flex":R<n?"none":"flex";R=n,S.duals.style={display:o}}}else if("enterPage"==e.method){if(S){var i=e.param[0];S.duals.style={display:0==i?"flex":"none"}}}else(t=b.msgHandle[e.method])&&t(e)}}var p=e("react"),g=(e("react-dom"),e("shadow-widget")),m=g.$main,y=g.$utils,v=(g.$ex,g.$idSetter,"All"),w=[],k=function(e,t){},b={state:{repo:"",repoDesc:"",category:v,doc:null,url:""}};b.instantTool=[{title:"Share document",show:"on_both",icon:"output/res/share.png",onClick:function(e){var t,n,i="",a=b.state,l=a.doc;l?(t=l.title||l.path.split("/").pop(),sPath=l.path,0==sPath.indexOf("md/")&&(sPath=sPath.slice(3)),n="index.html?doc="+encodeURIComponent(sPath),i="index.html?page="+encodeURIComponent(sPath)):(t=a.repoDesc||"Blog",n=a.category==v?"index.html":"index.html?cate="+encodeURIComponent(a.category));var r="Title: "+t+"\n\nURL: "+(n=o(a.repo+n).href);i&&(r+="\n\nOr: "+o(a.repo+i).href),alert(r)}}],b.menus=[{title:"Create document",onClick:function(e){y.popWin.popWindow();var t=y.loadElement(["Iframe",{key:"frame",frameBorder:"0",width:.9999,height:.9999,src:"output/menu_create.html"}]);y.popWin.showWindow(t,{width:.8,height:.9,manualClose:!0})}},{title:"Config documents",onClick:function(e){y.popWin.popWindow();var t=y.loadElement(["Iframe",{key:"frame",frameBorder:"0",width:.9999,height:.9999,src:"output/menu_config.html"}]);y.popWin.showWindow(t,{width:.8,height:.9,manualClose:!0})}}],b.msgHandle={configDone:function(e){var t=e.param[0],n=e.param[1];y.popWin.popWindow(),n&&w.length&&(t&&w[0][0].last_modify===n.last_modify||(t&&alert("The page will reload since global configure is changed by other APP."),setTimeout(k,0,n)))}};var C=/<\!-- SLIDE PAGES V[.0-9]+, DO NOT CHANGE THIS LINE\. -->/,$=null;m.$$onLoad.push(function(o){function i(){var e=document.body.getAttribute("data-loading");return"string"!=typeof e||0===parseInt(e)}function a(e){r>180?console.log("load shadow-widget system timeout"):(r+=1,setTimeout(function(){i()?setTimeout(l,100):a()},e||500))}function l(){if(g.$modules.length){for(var i=m.$$onLoad.length;g.$modules.length;)"function"==typeof(a=g.$modules.shift())&&a.call(n,e,t,n);for(var a,l=i;a=m.$$onLoad[l];l++)m.$$onLoading.push(a)}o()}if($)return o();var r=0;a(100)});var _=!1,x=null,E=null,P=null,O=null,S=null,I=null,T=null,N=null,M=null,W=v,D=-1,j=null,L=/^\/|http:|https:/,A=0,k=function(e,t){function n(){d(e,i,"");var n=[["Panel",{key:"doc",width:.9999,height:.9999,klass:"col-reverse",style:{backgroundColor:"#fff"}}],["Iframe",{key:"preview",frameBorder:0,width:.9999,height:.9999,src:""}]],a=[["Panel",{key:"list",klass:"col-reverse",left:0,top:0,width:.9999,height:.9999,borderWidth:[0,0,1,0],style:{position:"absolute"}}],["Panel",{key:"gap",width:.9999,height:36}],["Panel",{key:"items",width:.9999,height:-1,klass:"justify_center-end-default auto-hidden-visible",style:{backgroundColor:"#fff"},$id__:r}]],h=[["Panel",{key:"tool",klass:"nowrap-default-wrap_reverse",width:.9999,height:36,borderWidth:[0,0,1,0],style:{position:"absolute",backgroundColor:"#d8d8d8",borderColor:"#ccc"}}],["Div",{key:"menu",width:40,height:.9999,title:"Main menu",$id__:u,style:{display:"none",background:"url(output/res/menu.png) no-repeat center"}}],[["Panel",{key:"cate",width:-1,height:.9999}],["P",{key:"list",klass:"right-default-align_center",width:.9999,margin:[4,0,0,0],$id__:s}]],[["P",{key:"repo",klass:"align_center-right-default",margin:[4,0,0,0],width:110,height:.9999}],["Select",{key:"sel","dual-data":[i],$id__:c}]]],f=b.instantTool||[];if(f.length){var p=f.map(function(e,t){return["Img",{key:"tool"+t,src:e.icon,title:e.title||"",style:{width:"20px",height:"20px"},"data-show":e.show||"on_both",$onClick:e.onClick,$onMouseOver:function(e){this.duals.style={opacity:"0.5"}},$onMouseOut:function(e){this.duals.style={opacity:"1"}}}]});p.unshift(["P",{key:"inst",klass:"align_center-right-default",width:20*f.length+20,height:.9999}]),h.splice(3,0,p)}o.setChild(y.loadElement(n),y.loadElement(a),y.loadElement(h),function(e){S=o.componentOf("tool"),E=o.componentOf("doc.preview"),O=o.componentOf("list"),f.length&&(P=S.componentOf("inst"),l(!1)),t&&t()})}var o=g.W(".body").component,i=e.repos_desc||e.repos_name;w.length?(w.splice(0),W=v,D=-1,!t&&j&&j.setItem("lastCate",v),o.setChild("-doc","-list","-tool",function(e){S=null,E=null,O=null,P=null,n()})):n()},R=0;m.$$onLoad.push(function(e){function t(e,t){function n(e,n,o){var i,a="";if("string"==typeof o)i=e,a=o;else{var l=e.split(C);l.length>=2?(l.length>2&&console.log("warning: PINP document format error!"),i=l[0],a=l[1].trim()):i=e}t(!0,i,a,n)}for(var o="",i="",a=document.body,l=a.childNodes.length-1;l>=0;l--){var r=a.childNodes[l];if(8==r.nodeType){var s=r.nodeValue,d=s.indexOf("SLIDE PAGES: PART ");if(d>=0){var c=s[d+18];if("A"==c){o=s.slice(d+19);break}"B"==c&&(i=s.slice(d+19))}}}if(o||i)n(o,!1,i);else{var u=e.fileName.split("/"),h=u.pop();0==u.length&&u.push("md");var f=h.split(".");f.length>=2&&f.pop(),f.push("txt"),u.push(f.join("."));var p=u.join("/");y.ajax({type:"GET",url:p,dataType:"text",success:function(e,t,o){n(e,!0)},error:function(e,n){var o="error: load "+p+" failed";console.log(o),alert(o),t(!1,"","",!1)}})}}function n(e,t,n,o){var i=$.scanNodeAttr(t,"",0);if(!i||"ScenePage"!==i[0])return null;var a=i[1],l=a.key;l&&"string"==typeof l||(l="auto"+(e.comps.length+e.removeNum+o)),a["keyid."]=a.key=l;var r=g.$staticNodes.length,s=$.scanPreCode(t,"ScenePage["+o+"]",!0);return g.$staticNodes.length>r&&(a["hasStatic."]=!0),s.unshift(n,a),p.createElement.apply(null,s)}if($||g.__design__)return e();$=g.$creator,window.addEventListener("message",f,!1);var o=function(e){return{isFile:"file:"==e.protocol,isLocal:"localhost"==e.hostname||"127.0.0.1"==e.hostname,fileName:e.pathname.split("/").pop()||"index.html"}}(window.location),i=function(e){var t={};return e.split("&").forEach(function(e){if(e){var n=e.split("="),o=n[0].trim();o&&(t[o]=(n[1]||"").trim())}}),t}(window.location.search.slice(1));return i.page&&(o.fileName=decodeURIComponent(i.page)),"index.html"!=o.fileName?function(){function a(e){var t=/\$=['"]\.pinp\.doc_info\.title["']/m.exec(e);if(t){var n,o=e.indexOf(">",t.index);if(o>0&&(n=e.indexOf("<",o))>0)return e.slice(o+1,n).trim()}return""}var l=null,r=window.parent.window&&window.parent.window!==window;t(o,function(t,o,i,s){if(!t)return e();if(s){var d=a(o+"\n"+i);d&&(document.title=d)}var c=g.W(".body").component,u=[];if(i){var h=y.getWTC("ScenePage").ScenePage,f="",p=[],v=document.createElement("div");v.innerHTML=i;for(var w,k=0;w=v.children[k];k++)if("DIV"==w.nodeName&&(C=n(c.$gui,w,h,u.length))){var b=(C.props["keyid."]||"")+"";!C.props.noShow&&b&&p.push(b),0==u.length&&(f=b),u.push(C)}if(u.length){if(f&&0!=p.length)return r&&p.length>0&&document.body.addEventListener("slideenter",function(e){var t=e.pageKey,n=e.pageIndex,o=y.pageCtrl.isFirstEnter(e.target),i="[PROJECT_NAME]"+JSON.stringify({method:"enterPage",param:[n,t,o]});window.parent.window.postMessage(i,"*")},!1),u.push(function(t){function n(e,t){l=e,setTimeout(function(){e.duals["html."]=t},300)}function i(e){var t=[];p.forEach(function(e){var n=c.componentOf(e);n&&t.push([e,n])}),y.pageCtrl&&y.pageCtrl.destory(),y.pageCtrl=new $.pageCtrl_(t),l&&1==t.length&&(y.pageCtrl.config={size:"0x0",noSidebar:1,noKeypress:1,noFrame:1,noTrans:1},c.listen("innerSize",function(e,t){a.isHooked&&(a.duals.width=e[0],a.duals.height=e[1])})),e()}var a=null;if(p[0]==f){a=c.componentOf(f);var s=o&&(o.length>24||o.trim());if(a&&s){var d=a.componentOf("marked_doc");if(d)d.props["marked."]?n(d,o):console.log("error: marked_doc should be MarkedDiv"),m.$$onLoading.push(i),e();else{var u={key:"marked_doc",klass:"auto-hidden-visible",padding:[24,6,6,6],margin:0,left:-.5,top:-.5,width:.9999,height:.9999};r&&(u.$onScroll=function(e){var t="[PROJECT_NAME]"+JSON.stringify({method:"markScroll",param:[e.target.scrollTop]});window.parent.window.postMessage(t,"*")}),a.setChild(y.loadElement(["MarkedDiv",u]),function(t){(d=a.componentOf("marked_doc"))&&n(d,o),m.$$onLoading.push(i),e()})}return}}m.$$onLoading.push(i),e()}),void c.setChild.apply(c,u);u=[]}}var C=y.loadElement(["MarkedDiv",{key:"marked_doc",width:.9999,height:.9999,margin:0,padding:[24,6,6,6],klass:"auto-hidden-visible",style:{backgroundColor:"#fff"}}]);c.setChild(C,function(e){var t=c.componentOf("marked_doc");t&&(t.duals["html."]=o)}),e()}),i.page&&window.addEventListener("message",function(e){try{"object"==typeof e&&e.data?(e=e.data,e=JSON.parse(e.slice(14))):e=null}catch(t){e=null,console.log(t)}if("object"==typeof e&&"updateMark"==e.method){var t=e.param[0];if(l&&"string"==typeof t){var n=-1,o=!1,i=l.getHtmlNode();i&&(n=i.scrollTop)>6&&n+i.clientHeight>=i.scrollHeight-20&&(o=!0),l.duals["html."]=t,n>10&&setTimeout(function(){i.scrollTop=o?Math.max(0,i.scrollHeight-i.clientHeight):n},800)}}})}():h(o,i,e)})});