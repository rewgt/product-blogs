!function(){function _(a,b){var a=a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");return b&&(a=a.replace(/"/g,"&quot;")),a}function aa(a){var b=document.createElement("a");return b.href=a,""==b.host&&(b.href=b.href),b}function ba(a){var b={};return a.split("&").forEach(function(a){if(a){var c=a.split("="),d=c[0].trim();d&&(b[d]=(c[1]||"").trim())}}),b}function ca(a,b){var c=null;window.XMLHttpRequest?c=new XMLHttpRequest:window.ActiveXObject&&(c=new ActiveXObject("Microsoft.XMLHTTP")),c&&(c.onreadystatechange=function(){4==c.readyState&&(200==c.status?b(null,c.responseText):b(new Error("XMLHttpRequest failed")),c=null)},c.open("GET",a,!0),c.send(null))}function da(a,b,c){var d=null;if(window.XMLHttpRequest?d=new XMLHttpRequest:window.ActiveXObject&&(d=new ActiveXObject("Microsoft.XMLHTTP")),d){var e=JSON.stringify(b);d.onreadystatechange=function(){4==d.readyState&&(200==d.status?c(null,d.responseText):c(new Error("XMLHttpRequest failed")),d=null)},d.open("POST",a,!0),d.setRequestHeader("Content-Type","application/json; charset=utf-8"),d.send(e)}}function ea(a,b){if(!a.types)return!1;var c,d=a.types.length;for(c=0;c<d;c+=1)if(a.types[c]==b)return!0;return!1}function fa(a){a.stopPropagation()}function ga(a){a.stopPropagation(),a.preventDefault()}function ha(){return L&&"none"!=L.style.display}function sa(a){var b=a.split("/");if(b.length<=2)return null;for(var c,d=b.shift(),e="";c=b.shift();){if("$"!=c[0]||"$"!=c[1]){e+="/"+c;break}e+="/"+c}var f=b.join("/");return f?[d,e,f]:null}function ta(a,b){var c=Array.isArray(a)?a:sa(a+"");if(c){var d=c[0],e=d+c[1];if(!oa.hasOwnProperty(e)){var f,g=e+"/"+c[2];f=pa.isGithub?c[1]+"/TOOL.json":"/app/"+e+"/web/TOOL.json",ca(f,function(a,c){if(a)console.log("error: read file failed ("+f+")");else try{var d=JSON.parse(c);oa[e]=!1;var h={},i=[];Object.keys(d).forEach(function(a){var b=d[a];b&&Array.isArray(b.tools)&&(b.hasOwnProperty("baseUrl")?(b.tools.forEach(function(a){a.baseUrl=b.baseUrl}),h[a]=b):(b.name=a,i.push(b)))}),i.forEach(function(a){var c=a.opt||"mono/all",d=[],e=!1;if(a.tools.forEach(function(a){if("string"==typeof a){if("*"==a)return void(e=!0);var b=a.split("/"),c=b.pop(),f=b.join("/"),g=c&&h[f];if(g&&Array.isArray(g.tools)){var i=g.tools.find(function(a){return a.name===c});i&&d.push(i)}}}),oa[a.name]=[c,d,e],g==a.name&&b){var f=c.split("/");b[0]=f[0],b[1]=f[1]||"all"}})}catch(a){console.log(a),m.instantShow("error: parse JSON failed ("+f+").")}})}}}function ua(a){for(var b=ja.length-1;b>=0;b-=1)if(ja[b][0]===a){ja.splice(b,1);break}}function va(){var a="";if(O&&O.parentNode){var b=ib(O);b&&(a=b[0])}return{viewportX:j,viewportY:k,viewportWd:l,topPanelHi:m.frameInfo.topHi,rightPanelWd:m.frameInfo.rightWd,rootKeyid:V,showPages:"none"!=w.style.display,selected:a}}function wa(){if(!ka)return[];try{var a=localStorage.getItem("rewgt/design-bakIndex")||"[]";return JSON.parse(a)}catch(a){return[]}}function xa(){for(var a,b=wa(),c=[];a=b[1];)c.push(a[0]),b.splice(1,1);if(c.length)try{c.forEach(function(a){localStorage.removeItem("rewgt/design-bak_"+a)}),localStorage.setItem("rewgt/design-bakIndex",JSON.stringify(b))}catch(a){}}function ya(a,b){var c=b.length,d=Math.min(64,Math.max(3,parseInt(T.cacheSize)||5));d-=1;var e=1048576*d;if(c>e)return void m.instantShow("error: write backup failed (document size should less than "+d+"M).");var f=wa(),g=-1;na&&(g=f.findIndex(function(a){return a[0]==na}),g>=0&&g<f.length-1?g+=1:g=-1);var h=0;f.forEach(function(a,b){(g<0||b<g)&&(h+=a[1])}),h+=c;for(var i=[];h>e&&f.length;){var j=f.shift();i.push(j[0]),h-=j[1]}g-=i.length;try{if(g>=0)for(var j=f[g];j;)i.push(j[0]),f.splice(g,1),j=f[g];f.push([a,c]),i.forEach(function(a){localStorage.removeItem("rewgt/design-bak_"+a)}),localStorage.setItem("rewgt/design-bak_"+a,b),localStorage.setItem("rewgt/design-bakIndex",JSON.stringify(f)),na=0}catch(a){m.instantShow("error: save backup to local storage failed."),console.log("write local storage failed, it's size should large than 5M.")}}function za(a){try{return localStorage.getItem("rewgt/design-bak_"+a)}catch(a){return null}}function Ba(){if(!Aa&&m.dumpTree){var a=[];if(m.dumpTree(a),1==a.length){Aa=!0;var b=(new Date).valueOf()-1e3;ya(b,JSON.stringify({id:b,state:va(),doc:a[0]}))}}}function Ca(a){function c(){ma=setTimeout(function(){if(ma=0,b+=1,ja.length)if(b>=4){var d=ja[0][1];m.instantShow("hint: can not save backup when system not in idle"+(d?" (still in "+d+")":"")+".")}else a=1e3,c();else{var e=[];if(m.dumpTree(e),1==e.length){var f=(new Date).valueOf();ya(f,JSON.stringify({id:f,state:va(),doc:e[0]}))}}},a)}if(ka&&m.dumpTree){ma&&(clearTimeout(ma),ma=0);var b=0;"number"!=typeof a&&(a=3e3),c()}}function Da(a){if(!ka)return!1;if(ja.length){var b=ja[0][1];return m.instantShow("warning: task ("+a+") ignored when system not in idle"+(b?" (still in "+b+").":".")),!1}return!ma||(m.instantShow("warning: task ("+a+") ignored when pending backup not finished."),!1)}function Ea(){if(Da("undo")){var a=-1,b=wa();na?(a=b.findIndex(function(a){return a[0]==na}))>=0&&(a-=1):a=b.length-2;var c=a>=0?b[a][0]:0;if(!c||c<la)m.instantShow("warning: nothing to undo.");else{var d=za(c);if(!d)return void m.instantShow("warning: load backup item from local storage failed.");Ga(d),na=c}}}function Fa(){if(Da("redo")){var a=-1,b=wa();if(na&&(a=b.findIndex(function(a){return a[0]==na}),a>=0&&a+1<b.length?a+=1:a=-1),a<0)m.instantShow("warning: nothing to redo.");else{var c=b[a],d=c[0],e=za(d);if(!e)return void m.instantShow("warning: load backup item from local storage failed.");Ga(e),na=d}}}function Ga(a){function g(){mb(),j=e.viewportX||0,k=e.viewportY||0,l=e.viewportWd||0,m.frameInfo.topHi=e.topPanelHi||0,m.frameInfo.rightWd=e.rightPanelWd||0,m.style.left=j+"px",m.style.top=k+"px",n.style.backgroundPosition=d-14+"px "+(m.frameInfo.topHi+k)+"px",o.style.backgroundPosition=d+j+"px "+(b-28)+"px",o.style.display=m.frameInfo.topHi?"block":"none",p.style.display=m.frameInfo.rightWd?"block":"none",s.style.display=0==j&&0==k?"block":"none",Ra(),e.showPages?(t.style.visibility="visible",w.style.display="block"):(w.style.display="none",t.style.visibility="hidden"),w.innerHTML="",w.style.left="0px",e.rootKeyid?Ka(e.rootKeyid,!1,h):(o.listChildren(""),h())}function h(){var a=e.selected;if(!a)return void o.listChildren("");m.getWidgetNode&&m.getWidgetNode(a,"",function(a){kb(a,!1,!1)})}if(m.loadTree){var c=JSON.parse(a),e=c.state,f=c.doc;O=null,m.loadTree(m,f,function(){m.topmostNode()?g():alert("Restore backup version failed!")})}}function Ha(a,b){"ScenePage"==U&&La(V),b&&setTimeout(function(){$a(b)},100),Ca(a)}function Ia(a,b){var c=b.cloneNode(!0);c.style.display="block",c.style.position="static",c.style.width="900px",c.style.height="700px",c.style.transform="scale(0.142)",c.style.transformOrigin="0 0",c.style.zIndex="3006",a.appendChild(c);var d,e=b.querySelectorAll("canvas"),f=e.length;f&&f==(d=c.querySelectorAll("canvas")).length&&setTimeout(function(){for(var b,c,a=0;b=e[a];a++)if(c=d[a],c.width&&c.height){var f=c.getContext("2d");f.drawImage(b,0,0)}},600)}function Ja(a,b){var c=!1;if(b)c=!0;else{for(var g,e=0;g=a[e];e++){var h=g[0]+"",i=w.children[e];if(!i||i.getAttribute("keyid")!==h){c=!0;break}}c||a.length==w.children.length||(c=!0)}if(c){w.innerHTML="";var j=u.clientWidth||window.innerWidth-d-80,k=Math.floor(j/f);w.style.width=Math.max((a.length+k-1)*f,20)+"px",a.forEach(function(a){var b=a[0],c=b+"",d=a[1],e=d.getAttribute("name"),f=document.createElement("div");f.setAttribute("style","width:128px; height:100px; background:#fff; margin:2px 4px; float:left; overflow:hidden; outline:red dotted 0px"),f.setAttribute("keyid",c),e&&f.setAttribute("name",e),w.appendChild(f),Ia(f,d)})}for(var l,e=0;l=w.children[e];e++){var m=l.getAttribute("keyid")==V;l.style.outlineWidth=m?"1px":"0px"}}function Ka(a,b,c){if(!m.showRootPage)return void(c&&c());m.showRootPage(a,function(d){o.listChildren(""),U=d,V=U?a:"";for(var g,e="ScenePage"==d?a:"",f=0;g=w.children[f];f++){var h=g.getAttribute("keyid")==e;g.style.outlineWidth=h?"1px":"0px"}!b||"Panel"!=d&&"Template"!=d||m.getWidgetNode(m.frameInfo.rootName+"."+a,"",function(a){kb(a,!1,!1)}),e&&m.getWidgetNode(m.frameInfo.rootName+"."+a,"",function(b){b&&setTimeout(function(){var c=document.createEvent("Event");c.initEvent("slideenter",!0,!0),c.pageKey=a,b.dispatchEvent(c)},0)}),c&&c()})}function La(a){if(a){var b=null,c=[];m.listChildren&&(b=m.listChildren("")),b&&(c=b[4]);for(var f,d=null,e=0;f=c[e];e+=1)if(f[0]==a){d=f[1];break}if(d)for(var g,e=0;g=w.children[e];e++)if(g.getAttribute("keyid")==a){sName=d.getAttribute("name"),sName?g.setAttribute("name",sName):g.removeAttribute("name"),g.innerHTML="",Ia(g,d);break}}}function Ma(){var a=0==m.frameInfo.topHi;g=Math.floor(.5*(l||window.innerWidth-d-(a?0:c))),h=Math.floor(.5*(window.innerHeight-(a?0:b)-k))}function Na(){var a=0==m.frameInfo.topHi;q.style.top=(a?0:b)+(h-10)+k+"px",r.style.left=d+(g-10)+j+"px",s.style.left=l?d+l-20+j+"px":window.innerWidth-c-20+"px"}function Oa(a,b){function f(a){var b=Object.keys(a),c=[],d={};return b.forEach(function(b){var d,e=a[b];if("object"==e.type)if("default"in e)d=e.default;else{if(!("properties"in e))return;d={};var f=e.properties,g=Object.keys(f);g.forEach(function(a){d[a]=f[a].default})}else d=e.default;c.push([e.propertyOrder||0,b,d])}),c.sort(function(a,b){return a[0]-b[0]}),c.forEach(function(a){d[a[1]]=a[2]}),d}var c=null,d=null,e=null;return[function(g){var h=g.props&&m.widgetSchema(g,!1,b);return h&&2==h.length?(c=h[0],d=h[1],e=d.wdgtOption,delete d.wdgtOption,[f(d.properties||{}),a,e]):[null,a,null]},function(b,f,g){function l(b,c){var d=a;if(h&&(O=i),b){if(c)if(c.classList.contains("rewgt-scene")){var e=ra(c);lb(),e&&setTimeout(function(){Ka(e,!1,function(){kb(c,!1,!1)})},0)}else{var f=ib(c),g=f?f[0]:"";g&&g==a?kb(c,!1,!1):d=""}Ha(300,d)}}var h=!1,i=O;if(d&&e&&c&&f[0]){var j=f[1],k=f[2];if(m.saveWdgtProp&&"object"==typeof j&&Array.isArray(k))return h=!0,O=null,k.forEach(function(a){j[a]=void 0}),void m.saveWdgtProp(b,c,e,j,l)}return l(!1,null)}]}function Pa(a){for(var f,b=E.querySelectorAll("img"),c=null,d=0;f=b[d];d++)f.getAttribute("extend")?E.removeChild(f):(f.style.display="none",a&&"uplevel"==f.getAttribute("name")&&(c=f));c?(E.style.width=e+"px",E.style.visibility="visible",c.style.display="inline"):(E.style.width="0px",E.style.visibility="hidden")}function Qa(a,b,c,d){for(var k,g=E.querySelectorAll("img"),h=[],i=[],j=0;k=g[j];j++)if(k.getAttribute("extend"))E.removeChild(k);else{var l=k.getAttribute("name");l&&a[l]?h.push(k):i.push(k)}var n=[];b&&b.forEach(function(a){if(a.clickable&&(!a.onlyScene||d)){var b,e=a.icon,f=a.baseUrl||"";b=e?"/"==e[0]||0==e.indexOf("http")&&(":"==e[4]||"s:"==e.slice(4,6))?e:f&&"/"!=f.slice(-1)?f+"/"+e:f+e:pa.appBase()+"/res/tools.png";var g=document.createElement("img");g.setAttribute("extend","true"),g.setAttribute("style","display:none; width:16px; height:16px; border:1px solid #f0f0f0; margin:2px;"),g.setAttribute("src",b),a.title&&g.setAttribute("title",a.title),g.setAttribute("draggable","false"),E.appendChild(g),n.push(g),g.onload=function(a){a.target.style.display="inline"},g.onclick=function(b){if(!ha()&&(b.stopPropagation(),O&&O.parentNode&&m.popDesigner)){var d=ib(O);if(d){var e=d[0],g=Object.assign({},a);if(!g.get||!g.set){var h=Oa(e,c);g.get=h[0],g.set=h[1]}m.popDesigner(e,g.name,g,f)}}}}}),i.forEach(function(a){a.style.display="none"}),E.style.width=e*(h.length+n.length)+2+"px",h.forEach(function(a){a.style.display="inline"})}function Ra(a){var b,e=window.innerWidth,f=window.innerHeight;if(!(e<d+80+c)){b=l?Math.max(c,e-(d+l+j)):c,Ma(),m.frameInfo.rightWd=0==m.frameInfo.topHi?0:b,m.frameInfo.bottomHi=k,m.refreshFrame&&m.refreshFrame();var g=o.querySelectorAll("td")[2];g&&(g.style.width=b+"px"),p.style.left=e-b+"px",p.style.width=b+"px",y.style.height=f-64+"px";var h=e-d-b;t.style.width=h+"px",u.style.width=h-80+"px",v.style.width=h-80+"px",Na(),N.style.width=(N.isFull?e-d:e-d-m.frameInfo.rightWd)+"px"}}function Wa(a,b){function q(){A.inScene=e,A.style.borderColor=c?e?"transparent blue blue blue":"transparent red red red":e?"blue":"red",A.style.left=B.left+"px",A.style.top=B.top+"px",A.style.width=Math.max(0,B.width-2)+"px",A.style.height=Math.max(0,B.height-2)+"px",A.style.display="block"}function r(){C.style.borderColor=d?"transparent blue blue blue":"blue",C.style.left=D.left+"px",C.style.top=D.top+"px",C.style.width=Math.max(0,D.width-2)+"px",C.style.height=Math.max(0,D.height-2)+"px",C.style.display="block"}var c=!1,d=!1,e=!1;if(a){var f,g,h,i;try{f=a.getBoundingClientRect()}catch(a){f=null}if(!f)return;h=Math.min(0,f.top-m.frameInfo.topHi),h<0&&(c=!0,f={left:f.left,top:m.frameInfo.topHi,width:f.width,height:f.height+h});var j=!1;if(Ya.length){var k=Ya[Ya.length-1][2];try{g=k.getBoundingClientRect(),j=!0}catch(a){}j&&(i=Math.min(0,g.top-m.frameInfo.topHi))<0&&(d=!0,g={left:g.left,top:m.frameInfo.topHi,width:g.width,height:g.height+i})}var l=!1;j?l=D.left!=g.left||D.top!=g.top||D.width!=g.width||D.height!=g.height:(C.style.display="none",D={left:0,top:0,width:0,height:0});var n=(new Date).valueOf();(j&&O!==a||l)&&(Ua&&(clearTimeout(Ua),Ua=0),D=g,O!==a&&(Va=0),n-Va>2e3?r():(C.style.display="none",Ua=setTimeout(r,800)),Va=n);var o=!1,p=B.left!=f.left||B.top!=f.top||B.width!=f.width||B.height!=f.height;(O!==a||p)&&(Sa&&(clearTimeout(Sa),Sa=0),B=f,O!==a&&(Ta=0,O=a,P+=1,o=!0),b?(e=3==b.length&&"ScenePage"==b[1][0],A.isSceneWdgt=e):e=A.isSceneWdgt,n-Ta>2e3?q():(A.style.display="none",Sa=setTimeout(q,800)),Ta=n,o&&bb(b)),!o&&b&&setTimeout(function(){X.select()},0)}else O&&(C.style.display="none",A.style.display="none",O=null,G.innerHTML="",bb(null))}function $a(a){if(O&&O.parentNode&&m.widgetSchema){var b=ib(O);if(b){var c=b[0],d=b[2],e=_a(d);if((!a||c==a)&&e<2){var f=0!=e||_a(d,!0)>0;b=m.widgetSchema(c,!0,f),b&&y.setPropEditor(b[0],b[1],b[2],b[3])}}}}function _a(a,b){var c=0,d=a.length-2;for(b&&(d+=1);d>=0;){var e=a[d];if(d-=1,e[3])return 2;var f=e[0];if("Template"==f||"ScenePage"==f){for(;d>=0;){var g=a[d];if(d-=1,g[3]){c=2;break}}return c}var h,i=e[2];if(i&&(h=i[1]))if("some"==h)c=1;else if("none"==h)return 2;if(b)break}return c}function ab(a,b){var c=m.getGroupOpt(b);return c&&c.tools&&(a=a.slice(0),c.tools.forEach(function(b){b=Object.assign({},b),b.baseUrl=c.baseUrl,a.push(b)})),a}function bb(a){function b(){for(var a=!!m.hideTemplate;item=Ya.pop();)a&&m.hideTemplate(item[1],!0)}if(m.setSceneCurrent){var c=[],d=!1;if(Xa.length)if(!a||a.length<=2||"ScenePage"!=a[1][0])c.push([Xa[0],""]),Xa=[],d=!0;else{Xa[0]!=a[1][1]&&(d=!0,c.push([Xa[0],""]));var e=a[1][1],f=a[2][1];Xa[0]==e&&Xa[1]==f||(d=!0),Xa=[e,f],c.push(Xa)}else a&&a.length>2&&"ScenePage"==a[1][0]&&(Xa=[a[1][1],a[2][1]],d=!0,c.push(Xa));c.length&&m.setSceneCurrent(c),d&&setTimeout(function(){"ScenePage"==U&&La(V)},300)}if(!O)return b(),Za=[],y.setPropEditor(0,null,null),Q=!1,void(R=!1);if(a){b(),Za=[];var g=3==a.length&&"ScenePage"==a[1][0],h=!!m.showTemplate,i=a.length-1,j="",k=!1,l=!1;a.forEach(function(a,b){j&&(j+="."),j+=a[1];var c=a[0],d=a[2],e=a[3];e&&(Za.push(e),b==i&&(k=!0)),"Template"==c&&d&&(Ya.push(d),h&&m.showTemplate(d[1],!0),b==i&&(l=!0))}),Gb(j);var n=null,o=_a(a),p=0,q=!1,r=!1,s=O.getAttribute("data-group.optid");if(s){var t=oa[s];t?("all"!=(t[0]||"mono/all").split("/").pop()&&(r=!0),n=t[1],q=t[2]):p=500}else o>=2&&(p=500);setTimeout(function(){var b=!1;if(p&&s){var c=oa[s];c&&("all"!=(c[0]||"mono/all").split("/").pop()&&(r=!0,b=!0),n=c[1],q=c[2])}if(p&&o>=2&&(o=_a(a)),o>=2)Pa(!0),y.setPropEditor(0,null,null);else{var d=!1;if(j&&m.widgetSchema){b||(r=0!=o||_a(a,!0)>0);var c=m.widgetSchema(j,!0,r);c&&(d=O&&0==O.children.length&&c[4],y.setPropEditor(c[0],c[1],c[2],c[3]))}var e=a.length>=2?a[1][0]:"",f={copy:1};if(1!=o&&(f.move=1),k&&(f.linker=1,f.styles=1),d&&(f.edit_txt=1),(a.length>2||2==a.length&&("Panel"==e||"ScenePage"==e))&&(f.uplevel=1),g&&(f.copy_lnk=1,f.up=1,f.down=1),j&&m.getGroupOpt)if(q&&n)n=ab(n,j);else if(!n){var h=m.getGroupOpt(j),i=h&&h.tools||[];n=[],i.forEach(function(a){a=Object.assign({},a),a.baseUrl=h.baseUrl,n.push(a)}),r=h&&"all"!=h.editable}Qa(f,n,r,g)}},p)}Q=!!O.style.width,R=!!O.style.height}function hb(a){for(var c,b=0;c=a[b];b++){if(c[3]&&b<a.length-1)return!0}return!1}function ib(a,b){var c=m.children[0];if(!c)return null;for(var d=[],e=[],f=!1,g=null,h="";a;){if(a===c){f=!0,b&&b.unshift(a),d.unshift(["Panel",m.frameInfo.rootName,["mono","all"]]),h=m.frameInfo.rootName+h,e.forEach(function(a){a[1]=m.frameInfo.rootName+a[1]});break}var i=ra(a);if(i){var j=[],k=!1;if(a.classList.contains("rewgt-panel")?j.push("Panel"):a.classList.contains("rewgt-unit")?j.push("Unit"):a.classList.contains("rewgt-inline")&&(j.push("Span"),k=!0),j.length){g||(g=a);var l=k?"data-span.path":"data-unit.path";if(a.hasAttribute(l)||(l=""),j.push(i),a.hasAttribute("data-temp.type")){var n=a.getAttribute("data-temp.type"),o=[n,"",a];e.push(o),j.push(o),j[0]="Template"}else if(a.classList.contains("rewgt-scene")){var o=[a.getAttribute("name")||"","",a];e.push(o),j.push(o),j[0]="ScenePage"}else{var p=a.getAttribute("data-group.opt")||"",q=p.split("/"),r=["mono","none"],s=a.getAttribute("data-group.optid");if(s){var o=oa[s];o?(p=o[0]+"",q=p.split("/"),r[0]=q[0]||"mono",r[1]=q[1]||"all"):ta(s,r)}else r[0]=q[0]||"mono",r[1]=q[1]||"all";j.push(r)}if(l){var t=a.getAttribute(l),u=[t,"",a];e.push(u),j.push(u)}b&&b.unshift(a),d.unshift(j),h="."+i+h,e.forEach(function(a){a[1]="."+i+a[1]})}}a=a.parentNode}return f&&g?[h,g,d]:null}function jb(){if("0px"!=E.style.width){db+=1;var a=db;E.style.visibility="visible",cb=setTimeout(function(){a==db&&(E.style.visibility="hidden",cb=0)},4e3)}}function kb(a,b,c){if(!a)return null;var d=ib(a);if(d&&d.length>=2){if(b&&2==d.length&&"Panel"!=d[1][0])return d;var e=d[0],f=d[1],g=d[2];Wa(f,g),o.setWidgetInfo(g),o.listChildren(e),c&&jb()}return d}function lb(){I.style.display="none",Wa(null,null),o.setWidgetInfo(null),o.listChildren(""),Y=0,X.value=""}function mb(){O=null,U="",V="",Xa=[],Ya=[],Za=[],fb=!1,eb=0,gb=!1,wb=!1,Ab=!1,Bb=!1,Q=!1,R=!1,Z=null,$=0,I.style.display="none",C.style.display="none",A.style.display="none",m.style.zIndex="3000",K.style.display="none",L.style.display="none",M.style.display="none",G.innerHTML="",H.innerHTML="",H.isSceneWdgt=!1}function Gb(a){Array.isArray(a)&&(Z=null),m.dumpWidget&&setTimeout(function(){Y=1,m.dumpWidget(a,function(b,c){b&&($=P,Z=a,Y=2,X.value=c,X.select())})},0)}function Hb(a){function k(a,b){for(var d,c=1;d=I.children[c];c+=1){var e=d.getBoundingClientRect();if(a>=e.left&&a<e.left+e.width&&b>=e.top&&b<e.top+e.height)return!0}return!1}function l(a,c){if(a>d){if(m&&0==m.frameInfo.topHi)return!0;if(c>b)return!0}return!1}if(fb=!1,eb=0,!ha()){var c=a.target;if("IMG"!=c.nodeName||(c=c.parentNode,"DIV"!=c.nodeName||"float-btn"!==c.getAttribute("name"))){var e=a.clientX,f=a.clientY;if(l(e,f)){var g=document.body.style.cursor;if(O&&g&&("ew-resize"==g?eb=1:"ns-resize"==g?eb=2:"nwse-resize"==g&&(eb=3)),vb=!1,zb=!1,Cb=!1,nb=!1,fb=!1,eb)tb=e,ub=f;else if(!a.shiftKey&&"ScenePage"==U){var h=!1,i=!1;if(!O||O.classList.contains("rewgt-scene")||O.getAttribute("data-is.ground")&&(i=!0)){if(i?vb=!0:"block"==I.style.display&&I.children.length>1&&k(e,f)?(zb=!0,multiWdgtMoved_=!1,Eb=e,Fb=f):vb=!0,vb)for(xb=e,yb=f;I.children.length>1;)I.removeChild(I.children[1]);document.body.style.cursor="default"}else{var j=O.getBoundingClientRect();if(e>=j.left&&e<j.left+j.width&&f>=j.top&&f<j.top+j.height)h=!0,nb=!0,sb=!1,pb=e,qb=f;else{for(vb=!0,xb=e,yb=f;I.children.length>1;)I.removeChild(I.children[1]);document.body.style.cursor="default"}}h||a.preventDefault()}}}}}function Ib(a,b,c){for(var f,d=[a],e=1;f=I.children[e];e+=1){var g=f.getAttribute("keyid");g&&d.push(g)}if(!(d.length<=1)&&m.moveSceneWdgt){Ba(),d=m.moveSceneWdgt(d,b,c);for(var f,e=1;f=I.children[e];e+=1){var g=f.getAttribute("keyid");g&&d.indexOf(g)>=0&&(b&&(f.style.left=parseFloat(f.style.left)+b+"px"),c&&(f.style.top=parseFloat(f.style.top)+c+"px"))}Ha(3e3,"")}}function Jb(a){if(!(ha()||m.splitterMouseDn&&m.splitterMouseDn())){var b="default",c=a.clientX,d=a.clientY;if(vb){if(m.selectMultWdgt){for(;I.children.length>1;)I.removeChild(I.children[1]);var e=Math.min(c,xb),f=Math.min(d,yb),g=Math.max(c,xb),h=Math.max(d,yb),i=I.children[0];i?i.style.display="block":(i=document.createElement("div"),i.setAttribute("style","position:absolute; border:1px dotted red; left:0px; top:0px; width:0px; height:0px;"),I.appendChild(i)),i.style.left=e+"px",i.style.top=f+"px",i.style.width=Math.max(0,g-e-2)+"px",i.style.height=Math.max(0,h-f-2)+"px";var j=m.selectMultWdgt(V,xb,yb,c,d);j.forEach(function(a){var b=a[0],c=a[1],d=a[2],e=a[3],f=a[4],g=document.createElement("div");g.setAttribute("keyid",b),g.setAttribute("style","position:absolute; border:1px dotted red; left:"+c+"px; top:"+d+"px; width:"+Math.max(0,e-2)+"px; height:"+Math.max(0,f-2)+"px;"),I.appendChild(g)}),I.style.display="block",P+=1}}else{if(zb&&(Cb||(Math.abs(c-Eb)>=4||Math.abs(d-Fb)>=4)&&(zb=!1,Cb=!0,Db=ia+=1,ja.push([Db,"moving widget"]))),Cb){var k=c-Eb,l=d-Fb;return void(0==k&&0==l||(multiWdgtMoved_||(multiWdgtMoved_=!0,Ba()),Eb=c,Fb=d,Ib(V,k,l)))}if(!O||!O.parentNode)return void(document.body.style.cursor=b);var n=O.getBoundingClientRect(),o=Math.min(0,n.top-m.frameInfo.topHi);if(o<0&&(n={left:n.left,top:m.frameInfo.topHi,width:n.width,height:n.height+o}),c>=n.left&&c<n.left+n.width&&d>=n.top&&d<n.top+n.height&&(cb&&(clearTimeout(cb),cb=0),fb||"none"!=I.style.display||jb(),c>=n.left+n.width-6?d>=n.top+n.height-6?Q?b=R?"nwse-resize":"ew-resize":R&&(b="ns-resize"):Q&&(b="ew-resize"):d>=n.top+n.height-6&&R&&(b="ns-resize"),A.inScene&&!fb&&nb&&"default"==b&&"none"!=A.style.display&&m.splitterMouseDn&&!m.splitterMouseDn()&&(Math.abs(c-pb)>=4||Math.abs(d-qb)>=4))){var j=ib(O);j&&(E.style.visibility="hidden",rb=j[0],sb=!1,fb=!0,nb=!1,ob=ia+=1,ja.push([ob,"moving widget"]))}if(fb){eb=0,document.body.style.cursor="default";var k=c-pb,l=d-qb;(k||l)&&(pb=c,qb=d,sb||(sb=!0,Ba()),m.moveSceneWdgt(rb,k,l),k&&(A.style.left=parseInt(A.style.left)+k+"px"),l&&(A.style.top=parseInt(A.style.top)+l+"px"))}else document.body.style.cursor=b}}}function Kb(a){if(!ha()){if(m.splitterMouseDn&&m.splitterMouseDn()){wb=!1,vb=!1,I&&(I.style.display="none",I.children.length&&(I.children[0].style.display="none")),E.style.visibility="hidden",zb=!1,Cb=!1,Ab=!1,multiWdgtMoved_=!1,nb=!1,Bb=!1,fb=!1,sb=!1,eb=0;var b=ja.length;return void(b&&ja.splice(0,b))}if(wb=!1,I)if(I.children.length<=1)I.style.display="none";else{if(vb&&(wb=!0,setTimeout(function(){wb=!1},1e3),"ScenePage"==U&&V)){for(var e,c=[V],d=1;e=I.children[d];d+=1){var f=e.getAttribute("keyid");f&&c.push(f)}if(c.length>1)if(2==c.length&&m.getWidgetNode){var g=m.frameInfo.rootName+"."+V+"."+c[1];setTimeout(function(){m.getWidgetNode(g,"",function(a){a&&(I.style.display="none",kb(a,!1,!1))})},300)}else Wa(null,null),Gb(c)}I.children[0].style.display="none",E.style.visibility="hidden"}else;if(vb=!1,zb=!1,Ab=!1,Cb&&(Cb=!1,ua(Db),multiWdgtMoved_&&(Ab=!0,setTimeout(function(){Ab=!1},1e3),multiWdgtMoved_=!1,Ha(3e3,""))),nb=!1,Bb=!1,fb)fb=!1,ua(ob),sb&&rb&&(Bb=!0,setTimeout(function(){Bb=!1},1e3),sb=!1,Ha(3e3,rb));else if(O&&eb){gb=!0,setTimeout(function(){gb=!1},1e3);var h=a.clientX-tb,i=a.clientY-ub,j=!1;if(1!=eb&&3!=eb||0==h||(j=!0),2!=eb&&3!=eb||0==i||(j=!0),j&&m.resizeWidget){var k=ib(O);if(k&&!hb(k[2])){var l=k[0];Ba(),m.resizeWidget(l,eb,h,i,function(a){a&&Ha(3e3,l)})}}}eb=0,setTimeout(function(){var a=ja.length;a&&ja.splice(0,a)},0)}}function Lb(){function Da(a,b,c,d,e,f,g){if(m.copyWidget){var h=O,i=!1;h&&h.parentNode&&(O=null,i=!0),Ba(),m.copyWidget(a,b,c,d,e,f,function(a,b){if(a){var c="";if(b)if(b.classList.contains("rewgt-scene")){var d=ra(b);lb(),d&&setTimeout(function(){Ka(d,!1,function(){var a=ib(b);a&&(c=a[0]),kb(b,!1,!1)})},0)}else if(b.parentNode.parentNode===m&&"absolute"==b.style.position)lb();else if(i){var e=ib(b);e&&(c=e[0]),kb(b,!1,!1)}Ha(600,c)}else i&&(O=h);g&&g(a)})}}function Va(a){var b=a.target;"DIV"==b.nodeName&&(b.style.opacity="0.7")}function Xa(a){var b=a.target;"DIV"==b.nodeName&&(b.style.opacity="1")}function Ya(a){a.stopPropagation();var b=Math.floor(u.clientWidth/f);if(!(b<=0)){var c=Math.max(0,0-w.offsetLeft),d=Math.floor(c/f),e=w.children.length,g=a.target.getAttribute("name");"prev_page"==g?d>=b?w.style.left=0-c+b*f+"px":d>0&&(w.style.left="0px"):"next_page"==g?e>d+b&&(w.style.left=0-c-b*f+"px"):"prev_item"==g?d>0&&(w.style.left=0-f*(d-1)+"px"):"next_item"==g&&d+1<e&&(w.style.left=0-f*(d+1)+"px")}}function db(a,b,c,d,e,f){function i(){var c=g.widget,h=g.name||"";if(Array.isArray(c)){"/"==h[0]&&(h=h.slice(1));var i=sa(h);i?ta(i,null):h="",Ba(),a&&(c=g.scene||c),m.createWidget(c,h,b,d,e,f,function(a,b){a&&(b&&b.classList.contains("rewgt-scene")?(lb(),"visible"!=t.style.visibility&&m.instantShow("create ScenePage successful.")):b&&b.parentNode.parentNode===m&&b.getAttribute("data-temp.type")?lb():kb(b,!0,!1),Ha(300,""))})}}if(m.createWidget){var g=c.option;if("object"!=typeof g){if(void 0===g&&c.dragUrl){var h=c.dragUrl+".json";ca(h,function(a,b){if(a)m.instantShow("error: read JSON failed ("+h+")."),console.log(a);else{try{g=JSON.parse(b)}catch(a){console.log(a),m.instantShow("error: parse JSON failed ("+h+").")}g&&g.name&&i()}})}}else g.name&&i()}}function jb(a){if(ea(a.dataTransfer,"application/json"))a.preventDefault();else{if(!D)return;D!==F&&D.parentNode!==E||a.preventDefault()}}function mb(a){a.stopPropagation(),a.preventDefault();var b=H.textContent;if(b){var c=!!a.shiftKey||a.target===Sa,d=20-j-g,e=20-k-h;if(ea(a.dataTransfer,"application/json")){var f=null,l=a.dataTransfer.getData("application/json")||"{}";try{f=JSON.parse(l)}catch(a){console.log(a)}if(!f||"template"!=f.dragType&&"image"!=f.dragType)return;var n=!1;if("ScenePage"==U&&V){var o=b.split(".");(3==o.length||!c&&4==o.length)&&(n=!0)}if("image"==f.dragType){var p=f.dragUrl,q=f.clientWidth,r=f.clientHeight;if(!p)return;0==p.indexOf(i)&&p.length>i.length&&(p=p.slice(i.length));var s={src:p},t=["Img",s,3];q&&r&&(s.style={width:q+"px",height:r+"px"}),n&&(t=[["P",{klass:"default-large-small hidden-visible-auto","data-group.optid":"rewgt/shadow-slide/steps"},2],t]),db(n,b,{option:{name:"Img",widget:t}},c,d,e)}else db(n,b,f,c,d,e),F.style.display="none"}else if(D){var u=a.dataTransfer.getData("text/plain"),v=D.getAttribute("name");u&&b&&v&&("linker"==v&&m.bindLinker?(Ba(),m.bindLinker(u,b,function(a){a&&(F.style.display="none",Ha(300,""))})):"copy"!=v&&"move"!=v||Da(u,b,c,"move"==v,d,e,function(a){a&&(F.style.display="none")}))}}}function Rb(){if(O){var a=O.parentNode;if(a)return O.classList.contains("rewgt-scene")?void(m.resetRootShow?m.resetRootShow(function(){U="",V="",lb()}):lb()):void(kb(a,!1,!1)||O.classList.contains("rewgt-panel")&&"absolute"!=O.style.position&&lb())}}function $b(a){function i(a,b,c){if(m.removeWidget&&(!c||confirm("do you want delete selected widget?"))){var d="";if("ScenePage"==U&&b&&b.classList.contains("rewgt-scene"))for(var g,e=!1,f=0;g=w.children[f];f++){var h=g.getAttribute("keyid");if(h)if(h==V)e=!0;else if(d=h,e)break}Ba(),m.removeWidget(a,function(a){a&&(lb(),d&&setTimeout(function(){Ka(d,!1)},300),Ha(300,""))})}}var b=null;if("ScenePage"==U&&V&&"block"==I.style.display&&I.children.length>1){for(var e,c=[V],d=1;e=I.children[d];d+=1){var f=e.getAttribute("keyid");f&&c.push(f)}c.length>1&&(b=c)}else{if(!O||!O.parentNode)return;var g=ib(O);if(g){if(_a(g[2])>=1)return void m.instantShow("remove selected widget disallowed.");b=g[0]}}b&&i(b,O,a)}var B=0,D=null,Q=null,R=null,W=null;if(i=document.location.href.split("?")[0],"/"!=i.slice(-1)&&(i=i.slice(0,i.lastIndexOf("/")+1)),S=ba(window.location.search.slice(1)).page||"index.html",m=document.getElementById("react-container")){m.frameInfo?(Object.assign(m.frameInfo,{topHi:b,rightWd:c,bottomHi:0,leftWd:d}),setTimeout(function(){m.refreshFrame&&m.refreshFrame()},1e3)):m.frameInfo={topHi:b,rightWd:c,bottomHi:0,leftWd:d,rootName:".body"},m.classList.add("noselect-txt");var la=m.getAttribute("__design__");if(la&&"0"!=la){m.version=function(){return a},m.instantShow=function(a){if(a&&W){for(console.log("[MSG]",a);W.children.length>=5;){var b=W.children[0];W.removeChild(b)}var c=window.innerWidth,e=(window.innerHeight,0);c>800?(e=.2*c,c*=.6):c>400&&(e=.1*c,c*=.8),W.style.left=e+"px",W.style.width=c+"px";var f=document.createElement("p");f.setAttribute("style","width:"+(c-14)+"px; margin:2px; padding:6px; border:1px solid #ccc; background-color:#ffe; line-height:1.4; font-size:14px; color:#222; text-align:center; overflow:hidden; border-radius:3px; transition: all 0.4s ease-out; -o-transition: all 0.4s ease-out; -moz-transition: all 0.4s ease-out; -webkit-transition: all 0.4s ease-out; -ms-transition: all 0.4s ease-out;"),f.innerHTML=_(a),W.appendChild(f),W.style.display="block",setTimeout(function(){f&&f.parentNode&&(f.style.borderWidth="0px",f.style.margin="0px",f.style.padding="0px",f.style.height="0px")},1e4)}},Ma(),window.onbeforeunload=function(){return"This is single page application, do you want shift to another page?"},o=document.createElement("div"),o.setAttribute("style","position:absolute; left:0px; top:0px; width:100%; height:"+b+"px; background:#e8e8e8 url("+pa.appBase()+"/res/ruler_top.png) no-repeat fixed "+(d+j)+"px "+(b-28)+"px; z-index:3006;"),document.body.appendChild(o),n=document.createElement("div"),n.setAttribute("style","position:absolute; left:0px; top:0px; width:"+d+"px; height:100%; background:#e8e8e8 url("+pa.appBase()+"/res/ruler_left.png) no-repeat fixed "+(d-14)+"px "+(b+k)+"px; z-index:3020;"),document.body.appendChild(n),p=document.createElement("div"),p.setAttribute("style","position:absolute; right:0px; top:0px; width:"+c+"px; height:100%; background-color:#e8e8e8; z-index:3020; overflow:hidden;"),document.body.appendChild(p);var ma=document.createElement("div");ma.setAttribute("style","position:relative; left:3px; top:3px; line-height:1.2; width:100%; height:"+b+"px;"),n.appendChild(ma);var na=[["Main menu",pa.appBase()+"/res/menu.png","menu"],["Show pages/widgets",pa.appBase()+"/res/grid.png","thumb"]];na.forEach(function(a){var b=a[0],c=a[1],d=a[2],e=document.createElement("img");e.setAttribute("style","width:22px; height:22px; border:1px solid #e8e8e8;"),e.setAttribute("src",c),e.setAttribute("title",b),e.setAttribute("name",d),ma.appendChild(e)}),n.addEventListener("mouseover",function(a){var b=a.target;"IMG"==b.nodeName&&(b.style.borderColor="#f8f8f8 #aaa #aaa #f8f8f8")},!1),n.addEventListener("mouseout",function(a){var b=a.target;"IMG"==b.nodeName&&(b.style.borderColor="#e8e8e8")},!1);var va=document.createElement("div");va.setAttribute("style","position:relative; left:3px; top:0px; line-height:1.2; width:100%;"),n.appendChild(va);var na=[["Switch viewport",pa.appBase()+"/res/switch.png","switch"],["Align center",pa.appBase()+"/res/align.png","align"],["","",""],["Remove widget",pa.appBase()+"/res/delete.png","delete"],["Undo",pa.appBase()+"/res/undo.png","undo"],["Redo",pa.appBase()+"/res/redo.png","redo"],["","",""],["Save",pa.appBase()+"/res/save.png","save"],["Open or create page",pa.appBase()+"/res/open.png","open"],["Config",pa.appBase()+"/res/config.png","config"]];na.forEach(function(a){var b=a[0],c=a[1],d=a[2];if(c){var f="width:22px; height:22px; border:1px solid #e8e8e8;";!pa.useHtmlProxy||"open"!=d&&"config"!=d||(f+="display:none");var g=document.createElement("img");g.setAttribute("style",f),g.setAttribute("src",c),g.setAttribute("title",b),g.setAttribute("name",d),va.appendChild(g)}else{var e=document.createElement("div");e.setAttribute("style","width:100%; height:20px;"),va.appendChild(e)}}),q=document.createElement("div");var wa=b+(h-10)+k;q.setAttribute("style","position:absolute; left:"+(d-11)+"px; top:"+wa+"px; width:9px; height:18px; border:1px solid #aaa; background-color:rgba(192,192,192,0.7); cursor:ns-resize;"),q.setAttribute("title","Drag to move y-axis"),n.appendChild(q);var ya=0,za=!1,Aa=!1,Ca=0;q.addEventListener("click",fa,!1),q.addEventListener("mousedown",function(a){a.stopPropagation(),a.preventDefault(),za=!0,Aa=!1,ya=a.clientY},!1),document.addEventListener("mousemove",function(a){var c=a.clientY;if(!(c<=20||c>=window.innerHeight-20)&&(!Aa&&za&&Math.abs(c-ya)>=4&&(Ca=ia+=1,ja.push([Ca,"moving viewport"]),lb(),Aa=!0,za=!1),Aa)){a.stopPropagation(),a.preventDefault();var e=c-ya;0!=e&&(ya=c,k+=e,m.style.top=k+"px",q.style.top=b+(h-10)+k+"px",n.style.backgroundPosition=d-14+"px "+((0==m.frameInfo.topHi?0:b)+k)+"px")}},!1),document.addEventListener("mouseup",function(a){za=!1,Aa&&(ua(Ca),Aa=!1,a.stopPropagation(),a.preventDefault(),k+=a.clientY-ya,Ma(),m.style.top=k+"px",q.style.top=b+(h-10)+k+"px",n.style.backgroundPosition=d-14+"px "+((0==m.frameInfo.topHi?0:b)+k)+"px",m.frameInfo.bottomHi=k,m.refreshFrame&&m.refreshFrame())},!1),o.innerHTML='<table style="width:100%; height:100%; border-collapse:collapse; margin:0px; padding:0px; border:0px solid gray; table-layout:auto; overflow:hidden"><tr><td style="width:'+d+'px"></td><td style="vertical-align:top"></td><td style="width:'+c+'px"></td></tr></table>';var Ga=o.querySelectorAll("td")[1],Ia=document.createElement("div");Ia.setAttribute("style","width:100%; height:60px; margin:3px 0px 2px 0px; line-height:1.2; background-color:#f4f4f4; overflow-y:auto; border-radius:3px;"),Ga.appendChild(Ia);var Pa=document.createElement("div");Pa.setAttribute("style","width:100%; height:28px; overflow:hidden;"),Ga.appendChild(Pa);var Qa=document.createElement("div");Qa.setAttribute("style","width:100%; height:20px;"),Qa.setAttribute("title","Click to unselect widget"),Ga.appendChild(Qa),F=document.createElement("img"),F.setAttribute("draggable","true"),F.setAttribute("style","display:none; position:relative; left:0px; top:3px; width:16px; height:16px; border:1px solid #e8e8e8; margin:0px 6px 0px 0px;"),F.setAttribute("src",pa.appBase()+"/res/empty.png"),Pa.appendChild(F),G=document.createElement("span"),G.setAttribute("style","padding:2px 8px 2px 0px; color:#444;"),Pa.appendChild(G),H=document.createElement("span"),H.setAttribute("style","padding:2px 10px 2px 0px; color:#444;"),Pa.appendChild(H);var Sa=document.createElement("img");Sa.setAttribute("style","display:none; position:relative; left:0px; top:2px; width:16px; height:16px;"),Sa.setAttribute("src",pa.appBase()+"/res/insert.png"),Pa.appendChild(Sa),t=document.createElement("div");var Ta=window.innerWidth-d-c;t.setAttribute("style","visibility:hidden; position:absolute; left:"+d+"px; top:0px; width:"+Ta+"px; height:"+(b-10)+"px; background-color:#e8e8e8; overflow:hidden;"),o.appendChild(t),t.innerHTML='<div name="prev_page" title="previous page" style="position:absolute; left:1px; top:2px; width:20px; height:102px; background:#ccc"></div><div name="prev_item" title="previous item" style="position:absolute; left:21px; top:2px; width:20px; height:102px; background:#ddd"></div><div name="page_div" style="position:absolute; left:40px; top:0px; width:'+(Ta-80)+'px; height:104px; z-index:3006; overflow:hidden"><div name="page_list" style="display:none; position:relative; left:0px, top:0px; width:20px; height:100%; overflow:hidden"></div></div><div name="page_mask" style="position:absolute; left:40px; top:0px; width:'+(Ta-80)+'px; height:104px; z-index:3006; overflow:hidden"></div><div name="page_tip" style="display:none; position:absolute; z-index:3040; background-color:#ffd; border:1px solid #ddd; font-size:12px; color:#222; line-height:1; padding:4px; box-shadow:0 3px 3px rgba(0,0,0,0.2)"></div><div name="next_item" title="next item" style="position:absolute; right:20px; top:2px; width:20px; height:102px; background:#ddd"></div><div name="next_page" title="next page" style="position:absolute; right:0px; top:2px; width:20px; height:102px; background:#ccc"></div>',u=t.querySelector('div[name="page_div"]'),v=t.querySelector('div[name="page_mask"]'),w=t.querySelector('div[name="page_list"]');var Ua=t.querySelector('div[name="page_tip"]');v.addEventListener("mousedown",ga,!1),v.addEventListener("dragstart",ga,!1),v.addEventListener("dragend",ga,!1),v.addEventListener("dragover",function(a){if(D&&D.parentNode===E){var b=D.getAttribute("name");"copy"!=b&&"move"!=b||a.preventDefault()}},!1),v.addEventListener("drop",function(a){if(a.stopPropagation(),a.preventDefault(),D){var b=a.dataTransfer.getData("text/plain");if(b&&m.getWidgetNode){var c=D.getAttribute("name");if("copy"==c||"move"==c){var d=Math.floor(Math.max(0,0-w.offsetLeft)/f),e=v.getBoundingClientRect(),g=Math.max(0,a.clientX-e.left),h=d+Math.floor(g/f),i=w.children[h],j=null,k="",l=i?i.getAttribute("keyid")||"":"";h>0&&(j=w.children[h-1])&&(k=j.getAttribute("keyid")||""),m.getWidgetNode(b,"",function(a){if(a&&a.classList.contains("rewgt-scene")){var b=ib(a);if(b){var d=b[0],e=d.split("."),f=e.pop();if("move"==c&&(f==l||f==k))return;var g=!0,h=m.frameInfo.rootName;l&&(g=!1,e.push(l),h=e.join(".")),Da(d,h,g,"move"==c,0,0)}}})}}}},!1);var Za=0,$a=!1;v.addEventListener("click",function(a){a.stopPropagation(),a.preventDefault(),J.hideMenu();var c=Math.floor(Math.max(0,0-w.offsetLeft)/f),d=v.getBoundingClientRect(),e=Math.max(0,a.clientX-d.left),g=a.clientY,h=c+Math.floor(e/f),i=w.children[h];if(i){var j=i.getAttribute("keyid")||"",k=i.getAttribute("name");j=k?j+": "+k:j,j&&(Za&&(clearTimeout(Za),Za=0,Ua.style.display="none"),setTimeout(function(){$a||(Ua.style.left=e+40+2+"px",Ua.style.top=Math.min(b-36,g+20)+"px",Ua.innerHTML=_(j),Ua.style.display="block",Za=setTimeout(function(){Ua.style.display="none",Za=0},3e3))},500))}},!1),v.addEventListener("dblclick",function(a){a.stopPropagation(),a.preventDefault(),$a=!0,setTimeout(function(){$a=!1},1e3);var b=Math.floor(Math.max(0,0-w.offsetLeft)/f),c=v.getBoundingClientRect(),d=Math.max(0,a.clientX-c.left),e=b+Math.floor(d/f),g=w.children[e];if(g){var h=g.getAttribute("keyid");h&&(lb(),setTimeout(function(){Ka(h,!1),g.querySelector("canvas")&&setTimeout(function(){La(h)},600)},0))}},!1);for(var cb,bb=0;cb=t.children[bb];bb++)0!=(cb.getAttribute("name")||"").indexOf("page_")&&(cb.addEventListener("mouseover",Va,!1),cb.addEventListener("mouseout",Xa,!1),cb.addEventListener("click",Ya,!1));F.addEventListener("mouseover",function(a){var b=a.target;"IMG"==b.nodeName&&(b.style.borderColor="#f8f8f8 #aaa #aaa #f8f8f8")},!1),F.addEventListener("mouseout",function(a){var b=a.target;"IMG"==b.nodeName&&(b.style.borderColor="#e8e8e8")},!1),F.addEventListener("click",fa,!1),F.addEventListener("dblclick",function(a){a.stopPropagation(),F.style.display="none"},!1),F.addEventListener("dragstart",function(a){var b=F.getAttribute("title");b&&(B=ia+=1,ja.push([B,"dragging widget"]),D=F,a.dataTransfer.setData("text/plain",b))},!1),F.addEventListener("dragend",function(a){D&&ua(B),D=null,Q.selectedInfo=null,Q.style.display="none"},!1),G.addEventListener("click",fa,!1),H.addEventListener("click",function(a){a.stopPropagation();var b=a.target;if("SPAN"==b.nodeName){var c=b.getAttribute("title"),d=b.getAttribute("path");c&&d&&m.getWidgetNode&&m.getWidgetNode(c,d,function(a){kb(a,!1,!1)})}},!1),G.addEventListener("mousedown",fa,!1),G.addEventListener("mousemove",fa,!1),G.addEventListener("mouseup",fa,!1),H.addEventListener("mousedown",fa,!1),H.addEventListener("mousemove",fa,!1),H.addEventListener("mouseup",fa,!1);var hb=0;Pa.addEventListener("dragover",function(a){hb&&clearTimeout(hb);var b=D&&"linker"==D.getAttribute("name");hb=setTimeout(function(){H.style.backgroundColor="",Sa.style.display="none",hb=0},1e3),H.style.backgroundColor="#f8f8f8",Sa.style.display=b?"none":"inline"},!1),H.addEventListener("dragover",jb,!1),H.addEventListener("drop",mb,!1),Sa.addEventListener("dragover",jb,!1),Sa.addEventListener("drop",mb,!1),o.setWidgetInfo=function(a){var b="";a&&a.forEach(function(a,c){var d=a[0],e=a[1],f=a[2],g=a[3];if(c>0&&(e="."+e),"Template"==d&&f)b+='<span style="color:blue">'+_(e)+"</span>";else if(g){var h=g[0],i=g[1];b+=h&&i?'<span title="'+_(h,!0)+'" path="'+_(i,!0)+'" style="color:blue; text-decoration:underline">'+_(e)+"</span>":_(e)}else b+=_(e)}),H.innerHTML=b,H.isSceneWdgt=a&&3==a.length&&"ScenePage"==a[1][0]};var nb=!0;o.listChildren=function(a){var b="",c=["","#a00",-1,[],[]];m.listChildren&&(c=m.listChildren(a));var d=c[0],e=c[1],f=c[2],g=c[3],h=c[4];g.forEach(function(a,c){b+=c==f?'<button style="color:'+e+'">':"<button>",b+=_(a)+"</button>"}),Ia.innerHTML=b,d=a?d.replace(/</g,"").replace(/>/g,""):"",G.setAttribute("wdgt_name",d),G.innerHTML=d?"<b>"+_(d)+"</b>:":"",a||nb||Ja(h,!1)},Ia.addEventListener("click",function(a){var b=a.target;if("BUTTON"==b.nodeName){a.stopPropagation(),J.hideMenu();var c=b.textContent;if(c){if(!O)return void Ka(c,!0);if(m.getWidgetNode){var d=ib(O);if(d){var e=d[0],f=d[2];m.getWidgetNode(c,e,function(a,b){if(a)if(b){var d=2==f.length&&"ScenePage"==f[1][0];F.setAttribute("src",pa.appBase()+"/res/linker.png"),F.setAttribute("name","linker"),F.setAttribute("title",e+"."+c),F.isSceneWdgt=d,F.style.display="inline"}else kb(a,!1,!0)})}}}}},!1),r=document.createElement("div");var ob=d+(g-10)+j;r.setAttribute("style","position:absolute; left:"+ob+"px; top:"+(b-11)+"px; width:18px; height:9px; border:1px solid #aaa; background-color:rgba(192,192,192,0.7); cursor:ew-resize;"),r.setAttribute("title","Drag to move x-axis"),o.appendChild(r);var pb=0,qb=!1,rb=!1,sb=0;r.addEventListener("click",fa,!1),r.addEventListener("mousedown",function(a){a.stopPropagation(),a.preventDefault(),qb=!0,rb=!1,pb=a.clientX},!1),document.addEventListener("mousemove",function(a){var e=a.clientX;if(!(e<=d+20||e>=window.innerWidth-c-30)&&(!rb&&qb&&Math.abs(e-pb)>=4&&(sb=ia+=1,ja.push([sb,"moving viewport"]),lb(),rb=!0,qb=!1),rb)){a.stopPropagation(),a.preventDefault();var f=e-pb;0!=f&&(pb=e,j+=f,m.style.left=j+"px",o.style.backgroundPosition=d+j+"px "+(b-28)+"px",Na())}},!1),document.addEventListener("mouseup",function(a){if(qb=!1,rb){ua(sb),rb=!1,a.stopPropagation(),a.preventDefault();var e=a.clientX;if(e<=d+20||e>=window.innerWidth-c-30)return;var f=e-pb;0!=f&&(j+=f,m.style.left=j+"px",o.style.backgroundPosition=d+j+"px "+(b-28)+"px",Na()),s.style.display=0==j?"block":"none"}},!1),s=document.createElement("div");var tb=l?"left:"+(d+l-20+j)+"px":"left:"+(window.innerWidth-c-20)+"px";s.setAttribute("style","position:absolute; "+tb+"; top:"+(b-11)+"px; width:18px; height:9px; border:1px solid #aaa; background-color:rgba(192,192,255,0.7); cursor:ew-resize;"),s.setAttribute("title","Drag to resize width"),o.appendChild(s);var ub=0,vb=!1,xb=!1,yb=0;s.addEventListener("click",fa,!1),s.addEventListener("mousedown",function(a){a.stopPropagation(),a.preventDefault(),z.style.display="block",vb=!0,xb=!1,ub=a.clientX},!1),document.addEventListener("mousemove",function(a){var b=a.clientX;if(!(b<=d+200||b>=window.innerWidth-c-20)&&(!xb&&vb&&Math.abs(b-ub)>=4&&(yb=ia+=1,ja.push([yb,"resizing viewport"]),lb(),xb=!0,vb=!1),xb)){a.stopPropagation(),a.preventDefault();var e=b-ub;0!=e&&(l||(l=window.innerWidth-d-c),ub=b,l+=e,Ra())}},!1),document.addEventListener("mouseup",function(a){if(vb=!1,z.style.display="none",xb){ua(yb),xb=!1,a.stopPropagation(),a.preventDefault();var b=a.clientX;if(b<=d+200||b>=window.innerWidth-c-20)return;var e=b-ub;0!=e&&(l||(l=window.innerWidth-d-c),l+=e,Ra())}},!1),window.addEventListener("resize",Ra,!1),x=document.createElement("div"),x.setAttribute("style","position:relative; left:2%; top:0px; width:96%; height:60px; margin:4px 0px 0px 0px; line-height:1; background-color:#f4f4f4; overflow-y:auto; border-radius:3px;"),p.appendChild(x),y=document.createElement("div"),y.setAttribute("style","width:100%; height:"+(window.innerHeight-64)+"px;"),p.appendChild(y),z=document.createElement("div"),z.setAttribute("style","display:none; position:absolute; left:0px; top:0px; width:100%; height:100%; z-index:3020;"),p.appendChild(z),x.addEventListener("click",function(a){var b=a.target;"BUTTON"==b.nodeName&&(a.stopPropagation(),b.style.color||y.showPage(b.getAttribute("name")))},!1),y.addPage=function(a,b,c){for(var e,d=0;e=y.children[d];d++)if(e.getAttribute("name")==a)return;var f=document.createElement("button");f.setAttribute("name",a),f.textContent=c||a,x.appendChild(f);var g=document.createElement("div");g.setAttribute("name",a),g.setAttribute("style","display:none; width:100%; height:100%;"),y.appendChild(g);var h=document.createElement("iframe");h.setAttribute("frameborder","no"),h.setAttribute("border","0"),h.setAttribute("style","border:0px solid #ccc; width:100%; height:100%;"),g.appendChild(h),h.setAttribute("src",b)},y.showPage=function(a){for(var c,b=0;c=y.children[b];b++)c.style.display=c.getAttribute("name")==a?"block":"none";for(var d,b=0;d=x.children[b];b++)d.style.color=d.getAttribute("name")==a?"#a00":""},y.rmvPage=function(a){for(var d,b="",c=0;d=y.children[c];c++)if(d.getAttribute("name")==a){"none"!=d.style.display&&(c<y.children.length-1?b=y.children[c+1].getAttribute("name"):c>0&&(b=y.children[c-1].getAttribute("name"))),y.removeChild(d);for(var f,e=0;f=x.children[e];e++)if(f.getAttribute("name")==a){x.removeChild(f);break}break}b&&y.showPage(b)},y.setPropEditor=function(a,b,c,d){var e=y.querySelector('div[name="property"] > iframe');if(e&&e.contentWindow){var f=a&&b&&c?{method:"init",param:[a,b,c,d]}:{method:"clear",param:[]},g="[PROJECT_NAME]"+JSON.stringify(f);e.contentWindow.postMessage(g,"*")}},y.showPropEditor=function(a){var b=y.querySelector('div[name="property"] > iframe');if(b&&b.contentWindow){var c={method:"setVisible",param:[!!a]},d="[PROJECT_NAME]"+JSON.stringify(c);b.contentWindow.postMessage(d,"*")}};for(var Eb,zb=[],Cb=!1,Db=!1,na=document.querySelectorAll("meta"),bb=0;Eb=na[bb];bb+=1)if("pinp:template"==Eb.getAttribute("property")){var Fb=Eb.getAttribute("page"),Lb=Eb.getAttribute("content");"property"==Fb?Lb||(Cb=!0):"resource"==Fb?Lb||(Db=!0):Fb&&Lb&&zb.push([Fb,decodeURI(Lb)])}var Mb=aa("./").pathname;"/"!=Mb[0]&&(Mb="/"+Mb);var Nb=pa.appBase()+"/list_resource.html?base="+encodeURIComponent(Mb),Ob="";Cb||(Ob="property",y.addPage("property",pa.appBase()+"/prop_page.html"));var Pb="";if(pa.useHtmlProxy&&(pa.repoName&&(Pb+="&repo="+encodeURIComponent(pa.repoName)),pa.accessToken&&(Pb+="&token="+encodeURIComponent(pa.accessToken)),pa.accessUser&&(Pb+="&user="+encodeURIComponent(pa.accessUser)),pa.accessSite&&(Pb+="&site="+encodeURIComponent(pa.accessSite))),!Db){Ob||(Ob="resource");var Qb=Nb+"&home=1";pa.resourceBase&&(Qb+="&url="+encodeURIComponent(pa.resourceBase)),pa.useHtmlProxy&&(Qb+="&upload=1"+Pb),y.addPage("resource",Qb)}zb.forEach(function(a){Ob||(Ob=a[0]);var b=Nb+"&url="+encodeURIComponent(a[1]+"")+Pb;y.addPage(a[0]+"",b)}),ca("$utils?cmd=get_config",function(a,b){if(!a)try{var c=JSON.parse(b);if("object"==typeof c){T=c;(c.resourcePages||[]).forEach(function(a){Ob||(Ob=a[0]),y.addPage(a[0]+"",Nb+"&url="+encodeURIComponent(a[1]+"")+Pb)})}}catch(a){}Ob&&y.showPage(Ob)}),window.addEventListener("message",function(a){try{"object"==typeof a&&a.data?(a=a.data,a=JSON.parse(a.slice(14))):a=null}catch(b){a=null,console.log(b)}if("object"==typeof a)if("warning"==a.method)m.instantShow(a.param[0]+"");else if("onDialogLoad"==a.method){var b=N.querySelector("iframe");if(!b||b.messengerOK)return;b.messengerOK=!0,b.initDialog&&b.initDialog()}else if("onDialogExit"==a.method){var c=a.param[0],d=a.param[1];c&&(N.innerHTML="",m.setDialogModal(!1),m.setDesignModal(!1)),d&&(Ba(),m.saveDesigner&&m.saveDesigner(c,a.param[2],a.param[3]))}else if("saveProp"==a.method)try{if(m.updateWdgtProp){var e=O,f=!1;e&&e.parentNode&&(O=null,f=!0);var g=a.param[0],h=a.param[1],i=a.param[2]||[];i.forEach(function(a){h[a]=void 0}),Ba(),m.updateWdgtProp(g,h,function(a,b){if(a){if(b&&b.classList.contains("rewgt-scene")){var c=ra(b);lb(),c&&setTimeout(function(){Ka(c,!1,function(){kb(b,!1,!1)})},0)}else f&&b&&kb(b,!1,!1);Ha(300,"")}else f&&(O=e)})}}catch(a){console.log(a)}else if("dragEnd"==a.method){var j=a.param[0];"template"!=j&&"image"!=j||(Q.selectedInfo=null,Q.style.display="none")}else if("saveConfigData"==a.method){var c=a.param[0],d=a.param[1],k=a.param[2];c&&(N.innerHTML="",m.setDialogModal(!1),m.setDesignModal(!1)),d&&"object"==typeof k&&da("$utils?cmd=save_config",k,function(a,b){a?(m.instantShow("error: save configure failed"+(b?" ("+b+").":".")),console.log(a)):m.instantShow("save configure successful.")})}else"closeDialog"==a.method&&(N.innerHTML="",m.setDialogModal(!1),m.setDesignModal(!1))},!1),C=document.createElement("div"),C.setAttribute("style","display:none; position:absolute; z-index:3010; pointer-events:none; border:1px dashed blue;"),document.body.appendChild(C),W=document.createElement("div"),W.setAttribute("style","display:none; position:absolute; left:0px; top:0px; z-index:6000;"),document.body.appendChild(W),A=document.createElement("div"),A.setAttribute("style","display:none; position:absolute; z-index:3010; pointer-events:none; border:1px dotted red;"),document.body.appendChild(A);var na=[["Drag to move, double click to relay",pa.appBase()+"/res/move.png","move",!0],["Drag to insert, double click to relay",pa.appBase()+"/res/copy.png","copy",!0],["Drag to link, double click to relay",pa.appBase()+"/res/linker.png","linker",!0],["Modify child styles",pa.appBase()+"/res/styles.png","styles",!1],["Edit text content",pa.appBase()+"/res/edit_txt.png","edit_txt",!1],["Select uplevel",pa.appBase()+"/res/goup.png","uplevel",!1],["Copy as linker",pa.appBase()+"/res/copy2.png","copy_lnk",!1],["Pop to top",pa.appBase()+"/res/up.png","up",!1],["Push to bottom",pa.appBase()+"/res/down.png","down",!1]];E=document.createElement("div"),E.setAttribute("name","float-btn"),E.setAttribute("style","position:absolute; visibility:hidden; left:0px; top:-26px; width:"+(na.length*e+2)+"px; height:22px; border:1px solid #ddd; background-color:#f0f0f0; overflow:hidden; pointer-events:auto;"),A.appendChild(E),na.forEach(function(a){var b=a[0],c=a[1],d=a[2],e=a[3],f=document.createElement("img");f.setAttribute("style","width:16px; height:16px; border:1px solid #f0f0f0; margin:2px;"),f.setAttribute("src",c),f.setAttribute("title",b),f.setAttribute("name",d),f.setAttribute("draggable",e?"true":"false"),E.appendChild(f)}),E.addEventListener("mousedown",function(a){a.stopPropagation(),"true"!=a.target.getAttribute("draggable")&&a.preventDefault()},!1),E.addEventListener("mouseup",function(a){a.stopPropagation()},!1),E.addEventListener("mouseover",function(a){var b=a.target;"IMG"==b.nodeName&&(b.style.borderColor="#fff #aaa #aaa #fff")},!1),E.addEventListener("mouseout",function(a){var b=a.target;"IMG"==b.nodeName&&(b.style.borderColor="#f0f0f0")},!1),E.addEventListener("click",function(a){function v(a){a&&Ha(1e3,d)}function w(a){var b=a.props&&m.widgetSchema(a,!1,!0);return b&&2==b.length?(e=b[1].wdgtOption||null,[e&&e.linkStyles||null,d,c]):[null,"",""]}function x(a,b,c){function j(a,b){var c=d;if(f&&(O=g),a){if(b){var e=ib(b),h=e?e[0]:"";h&&h==d?kb(b,!1,!1):c=""}Ha(300,c)}}var f=!1,g=O,h=b[0],i=b[1];h&&e&&"object"==typeof i&&m.saveCompStyles?(f=!0,O=null,m.saveCompStyles(a,e,i,j)):j(!1,null)}function y(a){return[a.textContent,d,c]}function z(a,b,c){function i(a,b){var c=d;if(e&&(O=f),a){if(b){var g=ib(b),h=g?g[0]:"";h&&h==d?kb(b,!1,!1):c=""}Ha(300,c)}}var e=!1,f=O,g=b[0],h=b[1];g&&"string"==typeof h&&m.saveNodeContent?(e=!0,O=null,m.saveNodeContent(d,h,i)):i(!1,null)}if(!ha()){a.stopPropagation();var b=a.target,c="",d="",e=null;if("IMG"==b.nodeName){var f=b.getAttribute("name");if("up"!=f&&"down"!=f||!m.setWdgtZIndex){if("uplevel"==f)Rb();else if("styles"==f&&m.popDesigner){if(O&&O.parentNode){var h=ib(O);if(h){d=h[0],c=G.getAttribute("wdgt_name");var u={name:"default",title:"styles editor",url:pa.appBase()+"/edit_styles.html",halfScreen:!1,clickable:!0,width:.8,height:.8,get:w,set:x};m.popDesigner(d,"default",u,"")}}}else if("edit_txt"==f&&m.popDesigner){if(O&&O.parentNode&&0==O.children.length){var h=ib(O);if(h){d=h[0],c=G.getAttribute("wdgt_name");var u={name:"default",title:"text editor",url:pa.appBase()+"/edit_content.html",halfScreen:!0,clickable:!0,width:.8,height:.8,get:y,set:z};m.popDesigner(O,"default",u,"")}}}else if("copy_lnk"==f&&O&&O.parentNode){var h=ib(O);h&&(Y=2,X.value='<div $="'+h[0]+'"></div>',X.select(),document.execCommand("copy"),setTimeout(function(){E.style.visibility="hidden"},0))}}else{var g=null;if(O&&O.parentNode){var h=ib(O);if(h){var i=h[2];3==i.length&&"ScenePage"==i[1][0]&&(d=h[0],g=i[1][2][2])}}if(!g)return;for(var s,j=[],k=0,l=0,n=null,o=null,p=0,q=0,r=0;s=g.children[r];r++){var t=parseInt(s.style.zIndex)||0;t>=1e3&&(t-=2e3),0==r?(k=t,n=s,l=t,o=s):(t>=k&&(k=t,n=s,t>k&&(p=0),p+=1),t<=l&&(l=t,o=s,t<l&&(q=0),q+=1)),j.push([t,s])}if(0==j.length)return;if("up"==f){if(O===n&&1==p)return;Ba(),m.setWdgtZIndex(d,Math.min(999,k+1),v)}else{if(O===o&&1==q)return;Ba(),m.setWdgtZIndex(d,Math.max(-999,l-1),v)}}}}},!1),E.addEventListener("dblclick",function(a){if(!ha()){var b=a.target;if("IMG"==b.nodeName&&"true"==b.getAttribute("draggable")){a.stopPropagation();var c=b.getAttribute("src"),d=b.getAttribute("name");c&&(F.setAttribute("src",c),d&&F.setAttribute("name",d),F.setAttribute("title",H.textContent),F.isSceneWdgt=H.isSceneWdgt,F.style.display="inline")}}},!1),E.addEventListener("dragstart",function(a){if(!ha()){var b=H.textContent,c=a.target;b&&"IMG"==c.nodeName&&"true"==c.getAttribute("draggable")&&(B=ia+=1,ja.push([B,"dragging widget"]),D=c,D.isSceneWdgt=H.isSceneWdgt,a.dataTransfer.setData("text/plain",b))}},!1),E.addEventListener("dragend",function(a){D&&ua(B),D=null,Q.selectedInfo=null,Q.style.display="none"},!1),n.addEventListener("click",function(a){a.stopPropagation(),J.hideMenu(),lb()},!1),o.addEventListener("click",function(a){a.stopPropagation(),J.hideMenu(),lb()},!1),setInterval(function(){if(!fb)try{O&&O.parentNode?Wa(O,null):O&&lb()}catch(a){}},250),document.addEventListener("mousedown",Hb,!1),document.addEventListener("mousemove",Jb,!1),document.addEventListener("mouseup",Kb,!1),Q=document.createElement("div"),Q.setAttribute("style","display:none; position:absolute; z-index:3010; pointer-events:none; border:1px solid red;"),document.body.appendChild(Q);var Sb=document.createElement("div");Sb.setAttribute("style","position:absolute; left:0px; top:-24px; width:100px; height:22px; color:#a00;"),Q.appendChild(Sb),R=document.createElement("img"),R.setAttribute("style","display:none; position:absolute; right:0px; bottom:0px; width:16px; height:16px;"),R.setAttribute("src",pa.appBase()+"/res/insert.png"),Q.appendChild(R),ka?xa():setTimeout(function(){m.instantShow("warning: undo/redo not supported, your browser has no local storage.")},0),I=document.createElement("div"),I.setAttribute("style","display:none; position:absolute; left:0px; top:0px; z-index:3010; pointer-events:none;"),document.body.appendChild(I),J=document.createElement("ul"),J.setAttribute("style","position:absolute; z-index:3022; display:none; left:30px; top:30px; min-width:60px; background-color:#f4f4f4; border:1px solid #eee; margin:0px; padding:2px; line-height:1.4; border-radius:4px; box-shadow:-2px 4px 4px rgba(0,0,0,0.2); list-style:none; -webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;-o-user-select:none"),J.innerHTML='<li name="list_prj" style="padding:0px 8px">List projects</li><li name="show_doc" style="padding:0px 8px">Online document</li>',document.body.appendChild(J),pa.useHtmlProxy&&(J.querySelector('li[name="list_prj"]').style.display="none"),J.addEventListener("mouseover",function(a){var b=a.target;"LI"==b.nodeName&&(b.style.backgroundColor="blue",b.style.color="white")},!1),J.addEventListener("mouseout",function(a){var b=a.target;"LI"==b.nodeName&&(b.style.backgroundColor="",b.style.color="")},!1),J.addEventListener("click",function(a){a.stopPropagation(),J.style.display="none";var b=a.target;if("LI"==b.nodeName){var c=b.getAttribute("name");if("list_prj"==c)ca("$utils?cmd=list_project",function(a,b){if(a)return void m.instantShow("warning: query project failed.");try{var c,d,e=JSON.parse(b);if(Array.isArray(e)&&2==e.length&&Array.isArray(c=e[0])&&Array.isArray(d=e[1])){var f=c.length,g=c.concat(d),h={name:"default",title:"list project",url:pa.appBase()+"/list_projects.html",halfScreen:!0,width:.9,height:.9,clickable:!1};m.showDesignDlg(0,h,g,"",f)}}catch(a){}});else if("show_doc"==c){var d={name:"default",title:"online help",url:pa.appBase()+"/doc/index.html",halfScreen:!1,width:.9,height:.9,clickable:!1};m.showDesignDlg(0,d,{},"")}}},!1),J.showMenu=function(a,b){J.style.left=a+"px",J.style.top=b+"px",J.style.display="block"},J.hideMenu=function(){J.style.display="none"},K=document.createElement("div"),K.setAttribute("style","position:absolute; z-index:3020; display:none; left:0px; top:0px; width:100%; height:100%"),o.appendChild(K),L=document.createElement("div"),L.setAttribute("style","position:absolute; z-index:3020; display:none; left:0px; top:0px; width:100%; height:100%"),n.appendChild(L),M=document.createElement("div"),M.setAttribute("style","position:absolute; z-index:3020; display:none; left:0px; top:0px; width:100%; height:100%"),p.appendChild(M),N=document.createElement("div"),N.isFull=!0,N.setAttribute("style","position:absolute; z-index:3020; display:none; left:"+d+"px; top:0px; width:"+(window.innerWidth-d)+"px; height:100%; overflow:hidden"),document.body.appendChild(N);var Tb=!1,Ub=!1,Vb=null,Wb=null,Xb=0,Yb=0;N.onmouseup=M.onmouseup=L.onmouseup=K.onmouseup=function(a){Ub||a.stopPropagation()},N.addEventListener("mousemove",function(a){if(a.stopPropagation(),Tb&&Vb&&Vb.parentNode&&Wb&&Wb.parentNode){var b=a.clientX-Xb,c=a.clientY-Yb;Ub||(Math.abs(b)>=4||Math.abs(c>=4))&&(Ub=!0),!Ub||0==b&&0==c||(Vb.style.left=Vb.offsetLeft+b+"px",Vb.style.top=Vb.offsetTop+c+"px",Wb.style.left=Wb.offsetLeft+b+"px",Wb.style.top=Wb.offsetTop+c+"px",Xb+=b,Yb+=c)}},!1),document.addEventListener("mouseup",function(a){Tb=!1,Ub=!1,Vb&&Vb.parentNode&&(Vb.style.width="10px",Vb.style.height="10px")},!1),N.ondblclick=M.ondblclick=L.ondblclick=K.ondblclick=ga,N.onmousedown=M.onmousedown=L.onmousedown=K.onmousedown=ga,N.onmousemove=M.onmousemove=L.onmousemove=K.onmousemove=fa,N.onkeypress=M.onkeypress=L.onkeypress=K.onkeypress=ga,N.onkeydown=M.onkeydown=L.onkeydown=K.onkeydown=ga,N.onkeyup=M.onkeyup=L.onkeyup=K.onkeyup=fa,N.ondragover=M.ondragover=L.ondragover=K.ondragover=fa,N.ondrop=M.ondrop=L.ondrop=K.ondrop=fa,m.selectedWidget=function(a){var b=O;return a&&"string"==typeof a.nodeName&&(O=a),b&&b.parentNode?b:null},m.notifyBackup=function(a,b){Ha(b||300,a)},m.showDesignDlg=function(a,b,c,e,f){var g=window.innerWidth-d,h=window.innerHeight;b.halfScreen?(g-=m.frameInfo.rightWd,N.isFull=!1,y.showPropEditor(!1)):N.isFull=!0,N.style.width=g+"px",N.innerHTML="";var i,j=b.url+"";"/"==j[0]||0==j.indexOf("http")&&(":"==j[4]||"s:"==j.slice(4,6))?i=j:(e=e||"",i=e&&"/"!=e.slice(-1)?e+"/"+j:e+j);var n,k=parseFloat(b.left),l=parseFloat(b.top),o=parseFloat(b.width);"number"!=typeof o||o>=.9999&&o<1||o<=0?(o="100%",n=0):o>=1?(n=Math.floor((g-o)/2),o+="px"):(n=Math.floor((1-o)/2*g),"number"==typeof k&&k>0&&k<1&&k<1-o&&(n=Math.floor(k*g)),o=100*o+"%");var p,q=parseFloat(b.height);"number"!=typeof q||q>=.9999&&q<1||q<=0?(q="100%",p=0):q>=1?(p=Math.floor((h-q)/2),q+="px"):(p=Math.floor((1-q)/2*h),"number"==typeof l&&l>0&&l<1&&l<1-q&&(p=Math.floor(l*h)),q=100*q+"%"),Wb=document.createElement("iframe"),Wb.setAttribute("frameborder","no"),Wb.setAttribute("border","0"),Wb.setAttribute("style","position:absolute; border:0px solid #e0e0e0; left:0px; top:0px; width:100%; height:100%;"),Wb.style.left=n+"px",Wb.style.top=p+"px",Wb.style.width=o,Wb.style.height=q;var r=!0;"100%"!=o&&"100%"!=q&&(r=!1,Wb.style.borderWidth="1px",Wb.style.boxShadow="-2px 8px 4px rgba(0,0,0,0.1)"),Wb.messengerOK=!1,Wb.initDialog=function(){if(Wb.messengerOK&&m.pluginCss)try{var b=[a,c,m.pluginCss()];void 0!==f&&b.push(f);var d="[PROJECT_NAME]"+JSON.stringify({method:"init",param:b});Wb.contentWindow.postMessage(d,"*")}catch(a){console.log(a)}},Wb.exitDialog=function(){if(Wb.messengerOK){var a="[PROJECT_NAME]"+JSON.stringify({method:"close",param:[!0]});Wb.contentWindow.postMessage(a,"*")}else setTimeout(function(){N.innerHTML="",m.setDialogModal(!1),m.setDesignModal(!1)},0)},N.appendChild(Wb);var s=pa.useHtmlProxy?"$proxy.html":"$proxy";if(Wb.setAttribute("src",s+"?url="+encodeURIComponent(i)),!r&&!b.noMove){Vb=document.createElement("div"),Vb.setAttribute("style","position:absolute; left:"+n+"px; top:"+p+"px; width:10px; height:10px;");var t=document.createElement("div");t.setAttribute("style","width:10px; height:10px; background-color:#00d; cursor:move;"),Vb.appendChild(t),N.appendChild(Vb),t.onmousedown=function(a){a.stopPropagation(),a.preventDefault(),Vb&&Vb.parentNode&&(Tb=!0,Ub=!1,Vb.style.width="100%",Vb.style.height="100%",Xb=a.clientX,Yb=a.clientY)}}m.setDialogModal(!0)},m.setDesignModal=function(a){a||m.closeModal(),m.style.zIndex=a?"3012":"3000";var b=a?"block":"none";K.style.display=b,L.style.display=b,M.style.display=b,a||y.showPropEditor(!0)},m.setDialogModal=function(a){var b=a?"block":"none";a||(K.style.display="none",M.style.display="none",m.style.zIndex="3000"),L.style.display=b,N.style.display=b},N.onclick=M.onclick=L.onclick=K.onclick=function(a){a.stopPropagation(),J.hideMenu();var b=a.target;setTimeout(function(){var a=!1,c=null,d=!0;if(b===L||b===N)"none"!=N.style.display&&(c=N.querySelector("iframe"))&&c.exitDialog&&(a=!0),a||m.setDialogModal(!1);else for(var e=b.parentNode;e;){if(e===L||e===N){d=!1;break}if(e===document)break;e=e.parentNode}a?c.exitDialog():d&&m.setDesignModal(!1)},300)};var Zb=!0;m.addEventListener("click",function(a){function r(){if(Zb){var a=q[0],b=q[1],c=q[2];Wa(b,c),o.setWidgetInfo(c),o.listChildren(a),Q.style.display="none"}}if(!ha()&&!(eb||gb||wb||Ab||Bb||m.splitterMouseDn&&m.splitterMouseDn())){J.hideMenu();var b=a.target;if(a.shiftKey){var c=null,d="";if("ScenePage"==U&&V){for(;b&&b!==m;){var e=b.parentNode;if(e&&e.classList.contains("rewgt-center")){var f=e.parentNode;if(f&&f.classList.contains("rewgt-scene")){c=b;break}}b=e}c&&(d=ra(c))}if(d){var g=!1;if("block"==I.style.display&&I.children.length>=1){for(var j,h=!1,i=1;j=I.children[i];i+=1)if(d===j.getAttribute("keyid")){I.removeChild(j),h=!0;break}if(h)I.children.length<=1?I.style.display="none":g=!0;else{var k=c.getBoundingClientRect(),l=document.createElement("div");l.setAttribute("keyid",d),l.setAttribute("style","position:absolute; border:1px dotted red; left:"+k.left+"px; top:"+k.top+"px; width:"+Math.max(0,k.width-2)+"px; height:"+Math.max(0,k.height-2)+"px;"),I.appendChild(l),g=!0}}else if(!O||O.classList.contains("rewgt-scene")){var k=c.getBoundingClientRect(),l=document.createElement("div");l.setAttribute("keyid",d),l.setAttribute("style","position:absolute; border:1px dotted red; left:"+k.left+"px; top:"+k.top+"px; width:"+Math.max(0,k.width-2)+"px; height:"+Math.max(0,k.height-2)+"px;"),I.appendChild(l),I.style.display="block",g=!0}if(g){P+=1;for(var j,n=[V],i=1;j=I.children[i];i+=1){var d=j.getAttribute("keyid");d&&n.push(d)}n.length>1&&Gb(n)}}}else{var p=!1;if(O&&O.parentNode)for(;b&&b!==m;){if(b===O){p=!0;break}b=b.parentNode}I.style.display="none";var q=ib(a.target);q&&(Zb=!0,p?setTimeout(function(){r()},300):r())}}},!1),m.addEventListener("dblclick",function(a){if(!ha()&&!eb&&!gb&&O&&O.parentNode&&m.popDesigner){for(var b=a.target,c=!1;b&&b!==m;){if(b===O){c=!0;break}b=b.parentNode}if(c){var d=ib(O);if(d){Zb=!1;var e=d[0],f=d[2],g=O.getAttribute("data-group.optid"),h=_a(f),i=0!=h||_a(f,!0)>0;if(h<=1&&g&&g.indexOf("/")>0){var j=oa[g];if(Array.isArray(j)){var k=j[2];if(j=j[1]){k&&m.getGroupOpt&&(j=ab(j,e));var l=j.find(function(a){return"default"===a.name});if(l){var n=Object.assign({},l);if(!n.get||!n.set){var o=Oa(e,i);n.get=o[0],n.set=o[1]}return void m.popDesigner(e,"default",n,n.baseUrl||"")}}}}if(h<=1&&m.popDesigner(e,"default"))return;if(h>=2)return;var l={name:"default",title:"default editor",url:pa.appBase()+"/edit_prop.html",halfScreen:!0,clickable:!1,width:.9,height:.9},o=Oa(e,i);l.get=o[0],l.set=o[1],m.popDesigner(e,"default",l,"")}}}},!1),m.addEventListener("dragover",function(a){if(!ha()){var c,d=!!a.shiftKey,e=!1,f=!1;if(ea(a.dataTransfer,"application/json"))c=!1,e=!0;else{if(!D)return;if(D!==F&&D.parentNode!==E)return;f="linker"==D.getAttribute("name"),c=D.isSceneWdgt}var g=[],h=ib(a.target,g);if(h){var i=h[0],j=h[1],k=h[2],l=i.split(".").pop(),m=k.length>=2&&"ScenePage"==k[1][0],n=!1;if(m&&c&&!d){var o=k[1][2];if(i=o[1],f){if(!(g.length>=3))return;j=g[2],k=k.slice(0,3),l=k[2][1],i=i+"."+l}else g.length>=3?n=!0:(j=o[2],k=k.slice(0,2),l=k[1][1])}else m&&e&&!f&&g.length>=3&&(n=!0);if(n)for(var p=g.length-1;p>=2;){j=g[p];{if(!j.getAttribute("data-is.ground")){for(k=k.slice(0,p+1),l=k[p][1],p-=1,i=l;p>=0;)i=k[p][1]+"."+i,p-=1;break}p-=1}}var q=m&&3==k.length,r=m&&2==k.length,s=!1,t=j.getBoundingClientRect(),u=Math.min(0,t.top-b);u<0&&(s=!0,t={left:t.left,top:b,width:t.width,height:t.height+u}),Q.selectedInfo=[i,j,k],Q.style.left=t.left+"px",Q.style.top=t.top+"px",Q.style.width=Math.max(0,t.width-2)+"px",Q.style.height=Math.max(0,t.height-2)+"px",Q.style.borderColor=s?q?"transparent blue blue blue":"transparent red red red":q?"blue":"red",Q.style.display="block",Sb.innerHTML=_(l||""),!f&&t.width>=20&&t.height>=10&&!r?R.style.display="block":R.style.display="none",a.preventDefault()}else Q.style.display="none",e&&a.preventDefault()}},!1),m.addEventListener("drop",function(a){a.stopPropagation(),a.preventDefault();var c=!!a.shiftKey,e=a.clientX,f=a.clientY;if(!c&&"none"!=R.style.display){var l=R.getBoundingClientRect();e>=l.left&&e<l.left+l.width&&f>=l.top&&f<l.top+l.height&&(c=!0)}if(e=e-d-j-g,f=f-b-k-h,ea(a.dataTransfer,"application/json")){var n=null,o=a.dataTransfer.getData("application/json")||"{}";try{n=JSON.parse(o)}catch(a){console.log(a)}if(!n||"template"!=n.dragType&&"image"!=n.dragType)return;var p="none"!=Q.style.display&&Q.selectedInfo,q=p?p[0]:null;if("image"==n.dragType){var r=n.dragUrl,s=n.clientWidth,t=n.clientHeight;if(!r)return;0==r.indexOf(i)&&r.length>i.length&&(r=r.slice(i.length));var u=!1;if("ScenePage"==U&&V){(!q||q.split(".").length<=3)&&(q=m.frameInfo.rootName+"."+V,c=!0);var v=q.split(".");(3==v.length||!c&&4==v.length)&&(u=!0)}var w={src:r},x=["Img",w,3];s&&t&&(w.style={width:s+"px",height:t+"px"}),u&&(x=[["P",{klass:"default-large-small hidden-visible-auto","data-group.optid":"rewgt/shadow-slide/steps"},2],x]),db(u,q,{option:{name:"Img",widget:x}},c,e,f)}else{var u=!1;if("ScenePage"==U&&V&&q){var v=q.split(".");(3==v.length||!c&&4==v.length)&&(u=!0)}db(u,q,n,c,e,f)}}else if(D){var y=D.getAttribute("name"),z=a.dataTransfer.getData("text/plain"),p=Q.selectedInfo;if(y&&z&&p){var A=p[0];p[1],p[2];"linker"==y&&m.bindLinker?(Ba(),m.bindLinker(z,A,function(a){a&&(F.style.display="none",Ha(300,""))})):"copy"!=y&&"move"!=y||Da(z,A,c,"move"==y,e,f,function(a){a&&(F.style.display="none")})}}},!1),ma.querySelector('img[name="menu"]').onclick=function(a){a.stopPropagation(),J.showMenu(a.clientX,a.clientY)},qa=function(){"none"==w.style.display?(nb&&(nb=!1,0==w.children.length&&m.topmostNode&&m.topmostNode()&&lb()),t.style.visibility="visible",w.style.display="block"):(w.style.display="none",t.style.visibility="hidden")},ma.querySelector('img[name="thumb"]').onclick=function(a){a.stopPropagation(),J.hideMenu(),qa()},va.querySelector('img[name="switch"]').onclick=function(a){a.stopPropagation(),J.hideMenu(),m.frameInfo.topHi?(m.frameInfo.topHi=0,m.frameInfo.rightWd=0,n.style.backgroundPosition=d-14+"px "+k+"px",o.style.display="none",p.style.display="none"):(m.frameInfo.topHi=b,m.frameInfo.rightWd=c,n.style.backgroundPosition=d-14+"px "+(b+k)+"px",o.style.display="block",p.style.display="block"),Ra()},va.querySelector('img[name="align"]').onclick=function(a){a.stopPropagation(),J.hideMenu(),0==j&&0==k||(j=0,k=0,s.style.display="block",m.style.left=j+"px",m.style.top=k+"px",n.style.backgroundPosition=d-14+"px "+((0==m.frameInfo.topHi?0:b)+k)+"px",o.style.backgroundPosition=d+j+"px "+(b-28)+"px",Na(),m.frameInfo.bottomHi=k,m.refreshFrame&&m.refreshFrame())},va.querySelector('img[name="delete"]').onmousedown=function(a){a.stopPropagation(),a.preventDefault(),J.hideMenu(),$b(!0)},va.querySelector('img[name="undo"]').onclick=function(a){a.stopPropagation(),J.hideMenu(),Ea()},va.querySelector('img[name="redo"]').onclick=function(a){a.stopPropagation(),J.hideMenu(),Fa()},va.querySelector('img[name="save"]').onclick=function(a){function d(a,b){a?(m.instantShow("error: save document failed"+(b?" ("+b+").":".")),console.log(a)):m.instantShow("save document successful.")}if(a.stopPropagation(),J.hideMenu(),m.getDocHtml){var b=m.getDocHtml(pa.useHtmlProxy);if(!b)return void m.instantShow("warning: dump document failed.");if(pa.useHtmlProxy)pa.savePages(b,d);else{var c={page:S,html:b};da("$save?page="+encodeURIComponent(S),c,d)}}},va.querySelector('img[name="open"]').onclick=function(a){a.stopPropagation(),J.hideMenu(),ca("$utils?cmd=list_page",function(a,b){if(a)return void m.instantShow("warning: query HTML file list failed.");try{var c=JSON.parse(b);if(Array.isArray(c)){var d={name:"default",title:"open pages",url:pa.appBase()+"/list_pages.html",halfScreen:!0,width:.9,height:.9,clickable:!1},e=aa("./").href;m.showDesignDlg(0,d,{currProj:e,currFile:S,pages:c},"")}}catch(a){}})},va.querySelector('img[name="config"]').onclick=function(a){a.stopPropagation(),J.hideMenu();var b={name:"default",title:"edit configure",url:pa.appBase()+"/edit_config.html",halfScreen:!1,width:.8,height:.9,clickable:!1};m.showDesignDlg(0,b,T,"")};var _b=null,ac="";X=document.createElement("textarea"),X.setAttribute("style","position:absolute; left:0px; top:0px; width:24px; height:24px; overflow:hidden"),document.body.appendChild(X),X.addEventListener("copy",function(a){_b=null;var b=2==Y&&X.value;b&&$==P?setTimeout(function(){m.instantShow("copy successful, wait to paste...")},0):(a.preventDefault(),b&&$!=P&&m.instantShow("copy selected widget failed."))},!1),X.addEventListener("paste",function(a){var b=_b;_b=null,a.preventDefault();for(var f,c=a.clipboardData.types,d="",e=0;f=c[e];e+=1)if("Text"==f||f.startsWith("text/")){d=a.clipboardData.getData(f);break}var g="";if(d)if(!O&&"ScenePage"==U&&V)g=m.frameInfo.rootName+"."+V;else if(d&&O&&O.parentNode){var h=ib(O);h&&(g=h[0])}g&&m.pasteWidget&&(b&&(d!==ac&&(b=null),ac=""),Ba(),m.pasteWidget(g,d,b,function(a,b,c){a&&(m.instantShow(a+" widget(s) pasted."),b&&lb(),c&&setTimeout(function(){kb(c,!1,!1)},300),Ha(300,""))}))},!1),X.addEventListener("cut",function(a){var b=2==Y&&X.value;if($!=P)return a.preventDefault(),void(b&&m.instantShow("cut selected widget failed."));if(b&&"string"==typeof Z){var c=ib(Z);if(c){if(_a(c[2])>=1)return a.preventDefault(),void m.instantShow("cut selected widget disallowed.")}}b&&(_b=Z,ac=X.value,setTimeout(function(){m.instantShow("cut successful, wait to paste...")},0))},!1),X.addEventListener("keydown",function(a){var b=a.keyCode;if(!a.ctrlKey&&!a.metaKey||67!=b&&86!=b&&88!=b)if(a.preventDefault(),a.shiftKey){if(37==b)Rb();else if(39==b){if(O&&O.parentNode&&m.firstChildOf){var c=ib(O);if(c){var d=m.firstChildOf(c[0],!0);d&&kb(d,!1,!1)}}}else if(38==b||40==b){var c;if(O&&O.parentNode&&"ScenePage"==U&&V&&m.listPageChild&&(c=ib(O))){var e=c[2],f=e.length>=3?e[2][1]:"",c=m.listPageChild(V);if(c.length){bSort=[],c.forEach(function(a){var b=a[1],c=b.getBoundingClientRect();0==c.width&&0==c.height||bSort.push([c.top,c.left,a[0],b])}),bSort.sort(function(a,b){return a[0]==b[0]?a[1]-b[1]:a[0]-b[0]});var g=null;if(f)for(var i,h=0;i=bSort[h];h+=1)if(i[2]==f){g=38==b?h>0?bSort[h-1][3]:i[3]:h<bSort.length-1?bSort[h+1][3]:i[3];break}g||(g=38==b?bSort[0][3]:bSort[bSort.length-1][3]),kb(g,!1,!1)}}}}else if(a.altKey)if(8==b)$b(!1);else{var j=0,k=0;if(37==b?j=-1:38==b?k=-1:39==b?j=1:40==b&&(k=1),(j||k)&&"ScenePage"==U&&V)if("block"==I.style.display&&I.children.length>1)Ib(V,j,k);else if(O&&O.parentNode){var c=ib(O);if(c){var l=c[0];Ba(),c=m.moveSceneWdgt(l,j,k),1==c.length&&(j&&(A.style.left=parseFloat(A.style.left)+j+"px"),k&&(A.style.top=parseFloat(A.style.top)+k+"px"),Ha(3e3,l))}}}},!1)}}}var a="0.0.2",b=116,c=220,d=40,e=22,f=136,g=450,h=350,i="",j=0,k=0,l=0,m=null,n=null,o=null,p=null,q=null,r=null,s=null,t=null,u=null,v=null,w=null,x=null,y=null,z=null,A=null,B={left:0,top:0,width:0,height:0},C=null,D={left:0,top:0,width:0,height:0},E=null,F=null,G=null,H=null,I=null,J=null,K=null,L=null,M=null,N=null,O=null,P=0,Q=!1,R=!1,S="",T={},U="",V="",X=null,Y=0,Z=null,$=0,ia=0,ja=[],ka=!!window.localStorage,la=(new Date).valueOf()-1e3,ma=0,na=0,oa={},pa=null,qa=null,ra=function(a){return""},Aa=!1,Sa=0,Ta=0,Ua=0,Va=0,Xa=[],Ya=[],Za=[],cb=0,db=0,eb=0,fb=!1,gb=!1,nb=!1,ob=0,pb=0,qb=0,rb="",sb=!1,tb=0,ub=0,vb=!1,wb=!1,xb=0,yb=0,zb=!1,Ab=!1,Bb=!1,Cb=!1,Db=0,Eb=0,Fb=0;setTimeout(function(){function b(c){if(c){if((a+=1)>180)return void setTimeout(function(){c(!1)},0);setTimeout(function(){window.W&&W.$main&&W.$main.inRunning?c(!0):b(c)},500)}}var a=0;b(function(a){function g(a){Ka(a,!1),setTimeout(function(){qa()},2e3)}if(!a||"object"!=typeof W||!W.$creator)return void alert("load shadow-widget system failed!");var b=document.createElement("style");if(b.innerHTML="@-moz-document url-prefix(){button{padding:0px;}}",document.head.appendChild(b),pa=W.$creator,Lb(),W.$main&&(W.$main.inDesign=!0,m.keyOfNode&&(ra=m.keyOfNode)),m.onlyScenePage&&m.onlyScenePage()){var c=m.topmostNode();if(!c)return;for(var e,d=0;e=c.children[d];d++)if(e.classList.contains("rewgt-scene")){var f=ra(e);return void(f&&setTimeout(function(){g(f)},800))}}})},800)}();