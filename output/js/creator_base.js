window.W||(window.W=new Array,W.$modules=[]),W.$modules.push(function(e,t,n){function r(e,t,n){function r(e){e=e&&e.component,n&&n(e)}function i(e,t){function n(){var t=i.shift();if(!t)return r(e);var a=(e=e[t])&&e.component;if(!a)return r(null);var o=a.props["isTemplate."];if(!o||"none"!=(a.state.style||{}).display)return n();var s=3==o?"inline":2==o?"block":"flex",l=Object.assign({},a.state.style,{display:s});a.setState({style:l},n)}var i=t.split(".");if(!e){var a=i.shift();a||(a=i.shift());var o=(e=m)&&e.component;if(!o||o.$gui.keyid!=a)return r(null)}return n()}var a=c.pathLevelInfo(t);if(!a)return r(null);var o=a[0],s=a[1];if(a[2]){if(e){var l=p=e.widget;if(s<0&&(l=l&&l.parent),l)return i(l,o)}}else if(-1==s){if(o)return i(null,o)}else{if(!e)return r(null);for(var p=e.widget;p&&s>0;){var u=p&&p.component;if(u&&u.props["isNavigator."]&&0==(s-=1))break;var d=p.parent;if(!d){s-=1,p=f;break}p=d}if(p&&0==s)return o?i(p,o):r(p)}return r(null)}function i(e,t,n){for(var r=n?0:1,i=e.split("."),a=t.split("."),o=Math.min(i.length,a.length),s="",l=0,p=0;p<o;p++)if(i[p]!=a[p]){p>0&&(l=p,s=i.slice(0,l).join("."));break}var u="";if(s)if(a.length>=i.length&&l>=2&&l==i.length-r)u="//"+a.slice(l).join(".");else{for(var d=!1,c="",g=f.W(s);g;){var h=g.component;if(!h){g!==f&&(c="");break}if(h.props["isNavigator."]){d=!0;break}c="."+h.$gui.keyid+c,g=g.parent}if(!c&&!d)return"";u=a.slice(l).join("."),d?(c&&(c=c.slice(1)),u=c?"./"+c+(u?".":"")+u:"./"+u):c&&(u=c+(u?".":"")+u)}else u=t;return u}function a(e,t,n){function r(e){if(!e)return"";var t=g[e];if(t)return t;var n=e[0];if("#"==n&&4==e.length)return"#"+e[1]+e[1]+e[2]+e[2]+e[3]+e[3];if("#"==n&&7==e.length)return e;if("rgb"==e.slice(0,3)&&"("==(e=e.slice(3).trim())[0]&&")"==e.slice(-1)){var r=e.slice(1,-1).split(",");if(3==r.length)return t="#"+("0"+parseInt(r[0]).toString(16)).slice(-2),t+=("0"+parseInt(r[1]).toString(16)).slice(-2),t+=("0"+parseInt(r[2]).toString(16)).slice(-2)}return""}var i=e._;if(!i||!i._getGroupOpt)return null;var a,o,s=void 0,l=i._statedProp||[],f=i._silentProp||[],p=i._htmlText,d=i._className,c={name:d,desc:i._classDesc,option:i._getGroupOpt(e),doc:i._docUrl||"",linkPath:"",linkStyles:null},h=!1,m=0;void 0!==(s=e.state["data-unit.path"])?(m=2,h=!0,d="RefDiv"):void 0!==(s=e.state["data-span.path"])&&(m=3,h=!0,d="RefSpan"),h?(c.linkPath=s,c.linkStyles=e.props.styles):e.props["childInline."]?m=u.hasClass(e,"rewgt-unit")?2:3:u.hasClass(e,"rewgt-unit")&&(m=1),c.flag=m;var v,y;if(h){var w=e.props["link.props"];if(!w)return null;if(a=Object.assign({},w),o=a.style||{},delete a.style,delete a.styles,"string"==typeof(v=a["keyid."]))if("$"==v[0]){v=v.slice(1);var k=parseInt(v);k+""==v?(a["keyid."]=k,y=v=""):y=a["keyid."]=v}else y=v;else y=v=""}else{if(e.props["isReference."])return null;a=Object.assign({},e.props),o=a.style||{},delete a.style,y="string"!=typeof(v=e.$gui.keyid)?v="":v}if(l.forEach(function(t){a.hasOwnProperty(t)&&(a[t]=e.state[t])}),f.forEach(function(e){delete a[e]}),p){var b=h?a["html."]:e.state["html."];b&&"string"==typeof b&&(c["html."]=b)}delete a["html."],delete a.children,delete a["hasStatic."],a.key=y;var S={},O=!1,$=Object.keys(a),P=100,E={key:{propertyOrder:P,type:"string",default:v}};$.forEach(function(e){var r=e.indexOf(".");if(r>=0){if(r==e.length-1)return;return S[e]=a[e],void(O=!0)}if(!n||"$"!=e[0]){var i=a[e],o=!1;if(void 0!==i){if(0!=e.indexOf("data-")&&0!=e.indexOf("aria-")||(o=!0),"klass"==e){if("string"!=typeof i)return;var s=i.split(/[^-_a-zA-Z0-9]+/);if(0==s.length)return;return P+=1,void(E.klass={type:"array",options:{disable_array_reorder:!0},propertyOrder:P,items:{type:"string",format:"classname"},default:s})}var l=t[e],f="any",p=-1,u=null,d="";if(l){if(0==l.length)return;p=l[0],f=l[1]||"any",u=l[2]||null,d=l[3]||""}p<0&&(p=P+=1);var c={propertyOrder:p,default:i},g=!0;if(u&&(c.enum=u),d&&(c.description=d),o)c.type="string","string"!=typeof i&&(c.default=JSON.stringify(i));else if(null===i||"any"==f){"$"==e[0]&&(c.type="string");var h=typeof i;if("string"==h)i||(c.type="string");else{if("function"==h)return void console.log("warning: can not edit function property ("+e+")");c.default=JSON.stringify(i)}}else if("integer"==f){var m=parseInt(i);m+""==i+""?(c.type=f,c.default=m):g=!1}else"number"==f||"boolean"==f||"array"==f||"object"==f?"array"==f&&Array.isArray(i)?c.type=f:typeof i==f?c.type=f:g=!1:"string"==typeof i?(c.type="string","string"!=f&&(c.format=f)):g=!1;g||("string"!=typeof i&&(c.default=JSON.stringify(i)),console.log("warning: property ("+e+") is not match to expected type ("+f+").")),E[e]=c}}}),O&&(c.propsEx=S);var N=Object.keys(o);if(N.length){var C={};P+=1,E.style={type:"object",properties:C,propertyOrder:P},N.sort(),N.forEach(function(e){var t,n={type:"string",default:o[e]+""};if("color"==e||(t=e.indexOf("Color"))>0&&t+5==e.length){var i=r(n.default.trim());i&&(n.default=i,n.format="color")}C[e]=n})}return{type:"object",title:d+" - "+y,properties:E,wdgtOption:c}}var o=e("react"),s=e("react-dom"),l=o.createClass;l||console.log("fatal error: invalid React.createClass");var f=e("shadow-widget"),p=f.$main,u=f.$utils,d=f.$templates,c=f.$creator,g={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dodgerblue:"#1e90ff",feldspar:"#d19275",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgrey:"#d3d3d3",lightgreen:"#90ee90",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslateblue:"#8470ff",lightslategray:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370d8",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#d87093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",violetred:"#d02090",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"},h=null,m=null;p.$$onLoad.push(function(e){function t(e,t,n){if(3==t){if(3!=e)return u.instantShow("error: can not insert none-inline into inline widget."),!1}else if(2==t){if(0==e)return u.instantShow("error: can not insert panel into paragraph."),!1}else if(1==t){if(0==e){if(!n)return u.instantShow("error: can not insert panel into none-panel."),!1}else if(3==e)return u.instantShow("error: inline widget can not be inserted into panel or div."),!1}else if(3==e)return u.instantShow("error: inline widget can not be inserted into panel or div."),!1;return!0}function n(e,t,n,r,i,a){function l(){if(f){var e=N||0===N?N+"":"";n.linkPath&&"$"==e[0]&&(e=e.slice(1)),setTimeout(function(){e||(e=W.comps.length+W.removeNum-1);var t=m[e];(t=t&&t.component)&&(d=s.findDOMNode(t),i&&(y=t)),a&&a(f,d)},300)}else a&&a(f,d)}var f=!1,d=null,g=null,h=e.widget,m=h&&h.parent,v=m&&m.component;if(!v)return u.instantShow("warning: update property failed (out of date)."),l();if("object"!=typeof r)return l();var w=s.findDOMNode(e),k=w&&w.parentNode;if(k&&p(k))return u.instantShow("error: can not modify widget that under linker."),l();var b=r.klass;if(Array.isArray(b)){var S="";b.forEach(function(e){S&&(S+=" "),S+=(e||"undefined")+""}),b=S||void 0}else void 0!==b&&(b=null);delete r.klass;var O=r.style;if(O&&O instanceof Object){var $={},P=!1;Object.keys(O).forEach(function(e){P=!0;var t=O[e]+"";0==t.search(/^#[a-fA-F0-9]{6}$/)&&t[1]==t[2]&&t[3]==t[4]&&t[5]==t[6]&&(t="#"+t[1]+t[3]+t[5]),$[e]=t}),O=P?$:null}else O=null;delete r.style;var E=e.$gui.keyid,N=r.key,C=!1;if("string"==typeof N){if(N=N.trim())if(parseInt(N)+""==N)N="";else if(E!==N&&m[N])return u.instantShow("error: duplication of key name."),l();N||"string"!=typeof E||(C=!0)}else N="";delete r["keyid."],delete r.key,Object.keys(r).forEach(function(e){var n=r[e];if(0!=e.indexOf("data-")&&0!=e.indexOf("aria-")){if(void 0!==n){var i=t[e],a="any";if(i&&i.length&&(a=i[1]),"any"==a&&"string"==typeof n&&"$"!=e[0]){var o=n.trim(),s=o[0];if(('"'==s||"'"==s)&&o.length>=2&&o.slice(-1)==s)r[e]=o.slice(1,-1);else if("["==s&&"]"==o.slice(-1)||"{"==s&&"}"==o.slice(-1))try{r[e]=JSON.parse(o)}catch(e){console.log("error: parse JSON failed, input string:"),console.log(o)}else if("null"==o)r[e]=null;else{var l=parseFloat(o);l+""===o&&(r[e]=l)}}}}else r[e]=n+""}),C?(r["keyid."]="",r.key=""):N?r["keyid."]=r.key=N:(r["keyid."]=N=E,r.key=N+""),O?r.style=O:e.props.style&&(r.style=void 0),null!==b&&(r.klass=b);var _=n.propsEx;_&&Object.keys(_).forEach(function(e){r.hasOwnProperty(e)||(r[e]=_[e])});var x="",I=["-"+E],W=v.$gui,D=W.compIdx[E];if("number"!=typeof D)return l();if(!(g=W.comps[D]))return l();if(n.linkPath){var M=2==n.flag?c.RefDiv__:c.RefSpan__;r.$=n.linkPath;var j;"string"==typeof E?("$"!=E[0]&&(x="$"+E,I.push("-"+x)),j=""===N?E:N):(x="$"+E,I.push("-"+x),j=N+""),j&&"$"!=j[0]&&(j="$"+j),j&&(r["keyid."]=r.key=j),n.linkStyles&&(r.styles=n.linkStyles),n["html."]&&!r.hasOwnProperty("html.")&&(r["html."]=n["html."]),g=o.createElement(M,r)}else n["html."]&&!r.hasOwnProperty("html.")&&(r["html."]=n["html."]),g=c.deepCloneReactEle(g,r,h,e);for(var T=W.comps.length,A="",R=D+1;R<T;R+=1){var L=W.comps[R],q=L&&u.keyOfElement(L);if(q&&q!=x){A=q;break}}I.push(function(){f=!0,A?v.setChild("+"+A,g,l):v.setChild(g,l)}),v.setChild.apply(v,I)}h=c.containNode_,m=c.topmostWidget_,u.instantShow!==h.instantShow&&setTimeout(function(){"function"==typeof h.instantShow&&(u.instantShow=h.instantShow)},300),h.closeModal=function(e){function t(){e&&e()}var n=m&&m.component;if(!n)return t();var r=o.createElement(l(d.Panel._extend()),{"hookTo.":m,key:"$pop","keyid.":"$pop",left:0,top:0,width:0,height:0,style:{position:"absolute",zIndex:3016,overflow:"visible"}});n.setChild("$pop",r,t)},h.topmostNode=function(){var e=m&&m.component;return e?s.findDOMNode(e):null},h.pluginCss=function(){var e=[];return(f.$css||[]).forEach(function(t){if(Array.isArray(t)){var n=t[0],r=t[1];!r||"pseudo"!=n&&"basic"!=n&&"lazy"!=n||e.push(r+"")}}),e},h.getWidgetNode=function(e,t,n){function i(e){n&&n(e,a)}var a=!1;if(!e)return i(null);var o=null,l=e[0],p=("."==l||"/"==l)&&"/"!=e[1];if(t&&!p&&(o=f.W(t),!(o=o&&o.component)))return i(null);r(o,e,function(e){var t=null;e&&(a=!!e.props["isReference."],t=s.findDOMNode(e)),i(t)})},h.getDocHtml=function(e){var t=[];if(h.dumpTree(t=[]),1==t.length){var n=t[0];if(e){var r="",i=n[0];if(Array.isArray(i))for(var a,o=1;a=n[o];o++){var s=h.streamTree(a,0,1);s&&(r+=s)}return r}return h.streamTree(n,0,1)}return""},h.resetRootShow=function(e){var t=m,n=t&&t.component;if(n){var r=[];n.$gui.comps.forEach(function(e){if(e){var n=u.keyOfElement(e);if(n&&"$pop"!=n){var i=t[n];if(i=i&&i.component)if("absolute"==(i.state.style||{}).position)i.setState({style:Object.assign({},i.state.style,{display:"none"})});else{var a=u.hasClass(i,"rewgt-panel")?"flex":"block";r.push([i,a])}}}}),r.forEach(function(e){var t=e[1];(e=e[0]).setState({style:Object.assign({},e.state.style,{display:t})})})}e&&setTimeout(function(){e()},0)},h.showRootPage=function(e,t){function n(){t&&t(r)}var r="";if(!f.__design__||"$pop"==e)return n();var i=m,a=i&&i.component;if(a){var o=i[e];if(!(o=o&&o.component))return n();var l=s.findDOMNode(o);l&&(l.classList.contains("rewgt-panel")?r="Panel":l.classList.contains("rewgt-unit")?r="Unit":l.classList.contains("rewgt-inline")&&(r="Span"),r&&(l.hasAttribute("data-temp.type")?r="Template":l.classList.contains("rewgt-scene")&&(r="ScenePage")));var p=!1;"absolute"==(o.state.style||{}).position&&(p=!0);var d=[];a.$gui.comps.forEach(function(t){if(t){var n=u.keyOfElement(t);if(n&&"$pop"!=n){var r=i[n];if(r=r&&r.component){var a,o=u.hasClass(r,"rewgt-panel")?"flex":"block";"none"==(a="absolute"==(r.state.style||{}).position?p&&n==e?o:"none":p?"none":o)?r.setState({style:Object.assign({},r.state.style,{display:"none"})}):d.push([r,a])}}}}),d.forEach(function(e){var t=e[1];(e=e[0]).setState({style:Object.assign({},e.state.style,{display:t})})})}n()},h.removeWidget=function(e,t){if(e&&"string"==typeof e){var n=f.W(e),r=n&&n.component;if(r){var i=n.parent,a=r.$gui.keyid,o=i&&i.component;if(o)return void o.setChild("-"+a,function(e){t&&t(e)})}}else if(Array.isArray(e)&&e.length>=2){var s=m&&m[e[0]],l=s&&s.component;if(l&&l.props["isScenePage."]){var p=[];return e.slice(1).forEach(function(e){p.push("-"+e)}),p.push(function(e){t&&t(e)}),void l.setChild.apply(l,p)}}t&&t(!1)},h.listPageChild=function(e){var t=[],n=m&&m[e],r=n&&n.component;return r&&r.props["isScenePage."]&&(r.$gui.comps||[]).forEach(function(e){if(e){var r=u.keyOfElement(e);if("$"==r[0])return;var i=n[r];if(i=i&&i.component){var a=s.findDOMNode(i);a&&t.push([r,a])}}}),t},h.listChildren=function(e){var t=[],n=[],r=-1,i="",a="#a00",o=!0,l=m;e&&(l=f.W(e))!==m&&(o=!1);var p=l&&l.component;if(p){var d=p.$gui.comps||[],c=p.props["isNavigator."];d.forEach(function(e){if(e){var i=u.keyOfElement(e),f=i&&l[i];if(f=f&&f.component){if(o||c)if(o){if("$"==i[0]){if("$pop"==i)return;if("$"==i[1]&&e.props["isTemplate."])return}f.props["isScenePage."]&&n.push([i,s.findDOMNode(f)]);var p=f.state.style||{};"absolute"==p.position&&"none"!=p.display&&(r=t.length,a=f.props["isTemplate."]?"#00f":"#a00")}else f.props["isPlayground."]&&(r=t.length);t.push(i)}}}),i=p._._desc(p)}return[i,a,r,t,n]},h.resizeWidget=function(e,t,n,r,i){var a,o=f.W(e),l=!1,p=o&&o.component;if(p&&(a=s.findDOMNode(p))){if(u.hasClass(p,["rewgt-panel","rewgt-unit"])){var d=a.getBoundingClientRect(),g=p.state.width,h=p.state.height;if((1==t||3==t)&&"number"==typeof g)if(g>0&&g<1){g>=.9999&&(g=1);var m=Math.max(0,d.width+n);0==m?m=.001:(m/=d.width/g)>=1&&(m=.9999),p.duals.width=m,l=!0}else g>=1&&(p.duals.width=Math.max(1,d.width+n),l=!0);if((2==t||3==t)&&"number"==typeof h)if(h>0&&h<1){h>=.9999&&(h=1);var v=Math.max(0,d.height+r);0==v?v=.001:(v/=d.height/h)>=1&&(v=.9999),p.duals.height=v,l=!0}else h>=1&&(p.duals.height=Math.max(1,d.height+r),l=!0)}else if(p.props["childInline."]){var d=a.getBoundingClientRect(),y={};1!=t&&3!=t||(y.width=Math.max(0,d.width+n)+"px",l=!0),2!=t&&3!=t||(y.height=Math.max(0,d.height+r)+"px",l=!0),l&&(p.duals.style=y)}if(l){var w=o.parent;return w=w&&w.component,void(w?c.renewWidgetSpared(w,!0,function(){p.reRender(function(){i&&i(l)})}):p.reRender(function(){i&&i(l)}))}}i&&i(l)},h.setSceneCurrent=function(e){m&&e.forEach(function(e){var t=e[0],n=e[1],r=m[t];(r=r&&r.component)&&r.props["isScenePage."]&&r.setSelected(n)})},h.hideTemplate=function(e,t){var n=f.W(e),r=n&&n.component;r&&r.props["isTemplate."]&&(t&&n.parent===m||r.setState({style:Object.assign({},r.state.style,{display:"none"})}))},h.showTemplate=function(e,t,n){function r(){n&&n(i)}var i=!1,a=f.W(e),o=a&&a.component;if(!o)return r();var s=o.props["isTemplate."];if(!s)return r();if(t&&a.parent===m)return r();var l=3==s?"inline":2==s?"block":"flex";i=!0,o.setState({style:Object.assign({},o.state.style,{display:l})},r)};var p=function(e){return!(!e||e===h)&&(!(!e.getAttribute("data-unit.path")&&!e.getAttribute("data-span.path"))||p(e.parentNode))};h.isUnderLinker=p;var g=function(e,t){for(;e&&e!==h;){if(e.classList.contains("rewgt-panel")||e.classList.contains("rewgt-unit")||e.classList.contains("rewgt-inline"))if(t>0)t-=1;else{var n,r=e.getAttribute("data-group.opt");if(r&&"all"!=(n=r.split("/")[1]||"all"))return n}e=e.parentNode}return"all"};h.getEditableFlag=g,h.bindLinker=function(e,t,n){function r(){n&&n(a)}var a=!1,l=0,d=!1;if(e==t)return u.instantShow("error: can not link to self."),r();var g=f.W(e),h=f.W(t),m=g&&g.component,v=h&&h.component;if(!m||!function(e){if(l=e.props["isReference."])return d=!0,!0;var t=e.props["data-unit.path"];return t?(l=1,!0):!!(t=e.props["data-span.path"])&&(l=2,!0)}(m))return u.instantShow("error: source widget is not a linker."),r();if(!v)return u.instantShow("error: invalid target widget."),r();if(v.props["isTemplate."])return u.instantShow("error: can not link to a template."),r();if(2==l){if(!v.props["childInline."]||u.hasClass(v,"rewgt-unit"))return u.instantShow("error: RefSpan can only link to inline widget."),r()}else if(!u.hasClass(v,["rewgt-panel","rewgt-unit"]))return u.instantShow("error: RefDiv can only link to: panel, div, paragraph."),r();"number"==typeof v.$gui.keyid&&u.instantShow("warning: link to numbered-key is not suggested.");var y=i(e,t,!1);if(!y)return r();var w=g.parent,k=w&&w.component;if(!k)return r();if(p(s.findDOMNode(k)))return u.instantShow("error: binding path disallowed under a linker."),r();var b=m.$gui.keyid,S=b+"",O=S;"$"!=S[0]&&(b=S="$"+S);var $,P=null,E=k.$gui,N=E.compIdx[O];if("number"==typeof N&&(P=E.comps[N]),!P)return r();var C={$:y,key:S,"keyid.":b};if(d)$=o.cloneElement(P,C);else{var _=2==l?c.RefSpan__:c.RefDiv__;$=o.createElement(_,Object.assign(m.props["link.props"]||{},C))}var x=E.comps[N+1],I=x&&u.keyOfElement(x);k.setChild("-"+O,function(){a=!0,I?k.setChild("+"+I,$,r):k.setChild($,r)})},h.createWidget=function(e,n,r,i,a,l,d){function v(){if(d){if(w&&S)for(var e,t=Object.keys(S.$gui.compIdx),n=0;e=t[n];n+=1)if(!k.hasOwnProperty(e)&&"$"!=e[0]){var r=S.widget,i=r&&r[e],a=i&&i.component;a&&(b=s.findDOMNode(a));break}d(w,b)}}function y(){if(S=i?$:E,p(s.findDOMNode(S)))return u.instantShow("error: can not add widget to a linker."),v();var e=q.props["data-unit.path"],t=q.props["data-span.path"],r="",f="string"==typeof e?"data-unit.path":"string"==typeof t?"data-span.path":"";if(f){if(S.widget===m)return u.instantShow("error: can not use linker under topmost widget."),v();(r=t||e)||u.instantShow("warning: link path is empty.")}var d=u.keyOfElement(q),c=!1,g=!1;d&&"string"==typeof d?((g=0==d.search(/^auto[0-9]+$/))||parseInt(d)+""===d)&&(c=!0):c=!0;var h=!1;c?h=!0:"number"==typeof S.$gui.compIdx[d]&&(h=!0);var y=H&&!B;if(h){P={"keyid.":"",key:""};if(g&&S.props["isScenePage."]){for(var b=S.$gui.removeNum+S.$gui.comps.length,O="auto"+b;"number"==typeof S.$gui.compIdx[O];)O="auto"+(b+=1);P["keyid."]=P.key=O}f&&(P[f]=r),y&&(P.left=a,P.top=l),n&&(P["data-group.optid"]=n+""),q=o.cloneElement(q,P)}else if(f||y||n){var P={};f&&(P[f]=r),y&&(P.left=a,P.top=l),n&&(P["data-group.optid"]=n+""),q=o.cloneElement(q,P)}w=!0,i?(Object.assign(k,S.$gui.compIdx),S.setChild(q,v)):(Object.assign(k,S.$gui.compIdx),S.setChild("+"+$.$gui.keyid,q,v))}var w=!1,k={},b=null,S=null,O=null;r?O=f.W(r):h.children[0]&&(O=m,r=h.frameInfo.rootName,i=!0);var $=O&&O.component,P=O&&O.parent,E=P&&P.component;if(!$||!i&&!E)return u.instantShow("error: invalid target widget."),v();var N=s.findDOMNode($);if(N&&"all"!=g(N,i?0:1))return u.instantShow("error: insert target is disallowed."),v();if(!e[0]){var C=(L=e[1])&&L.html;if(Array.isArray(C)){var _=i?$:E;if((b=s.findDOMNode(_))&&p(b))return u.instantShow("error: can not add widget to a linker."),v();var x,I=C.join(""),W=document.createElement("div");if(W.innerHTML=I,(x=W.children.length)>0){for(var D=[],M=f.$staticNodes.push(D)-1,j=0;j<x;j+=1)D.push(W.children[j]);var T=_.$gui,A=T.comps.length+T.removeNum,R=M+"",L={"keyid.":A,key:A+"",className:"rewgt-static",name:R};f.__design__&&(L.onMouseDown=c.staticMouseDown,L.onDoubleClick=c.staticDbClick.bind(_));var q=o.createElement(_.props["childInline."]?"span":"div",L),z=T.compIdx;if(M=-1,i||(M=z[$.$gui.keyid]),"number"==typeof M&&M>=0){z=z;for(var G in z){var J=z[G];J>=M&&(z[G]=J+1)}T.comps.splice(M,0,q)}else M=T.comps.push(q)-1;z[A]=M,w=!0,_.reRender(function(){if(b){var e=b.querySelector('.rewgt-static[name="'+R+'"]');if(e)for(var t,n=0;t=D[n];n++)e.appendChild(t)}})}return void(d&&setTimeout(function(){d(w,b)},0))}}if(!(q=u.loadElement(e)))return v();var H=null,U=null,B=q.props["isScenePage."];if($.props["isScenePage."])H=$,U=O;else if(E&&E.props["isScenePage."])if(i){if(B)return u.instantShow("error: ScenePage can only insert into topmost widget."),v()}else H=E,U=P;var F,Z=" "+q.props.className+" ",K=Z.indexOf(" rewgt-panel ")>=0?0:Z.indexOf(" rewgt-unit ")>=0?1:3;if(1==K&&q.props["childInline."]&&(K=2),H){if(U.parent!==m||!m.component)return u.instantShow("error: invalid target ScenePage."),v();if(F=0,O=U,$=H,B)return P=m,E=m.component,i=!1,y();if(3==K)return u.instantShow("error: only panel, div, paragraph can add to ScenePage."),v();P=null,E=null,i=!0}else{if(B&&(O!==m||!i))return u.instantShow("error: ScenePage can only hook to topmost widget."),v();1==(F=$.$gui.isPanel||O===m?0:u.hasClass($,"rewgt-unit")?1:3)&&$.props["childInline."]&&(F=2);var Q=!1;if(1==F&&$.props["isTableRow."]&&(Q=!0),!i){if(O===m||!E)return void u.instantShow("error: can not insert before topmost widget.");1==(F=E.$gui.isPanel||P===m?0:u.hasClass(E,"rewgt-unit")?1:3)&&E.props["childInline."]&&(F=2)}if(!t(K,F,Q))return v()}return y()},h.copyWidget=function(e,t,n,r,i,a,o){function l(){var e=b.$gui,t=e.compIdx[w.$gui.keyid],l="number"==typeof t&&e.comps[t];if(!l)return d();if(D=n?O:P,p(s.findDOMNode(D)))return u.instantShow("error: can not add target widget under a linker."),d();var f=b.props["isScenePage."]&&!C,g=l.props["data-unit.path"],E=l.props["data-span.path"],N="",_="string"==typeof g?"data-unit.path":"string"==typeof E?"data-span.path":"";if(_){if(D.widget===m)return u.instantShow("error: can not use linker under topmost widget."),d();if((n?S:$)!==k)return u.instantShow("error: can not move linked-linker to another widget, use unlinked-linker instead."),d();if(!(N=E||g))return u.instantShow("warning: invalid link path."),d()}var I=u.keyOfElement(l),M=!1,j=!1;I&&"string"==typeof I?((j=0==I.search(/^auto[0-9]+$/))||parseInt(I)+""===I)&&(M=!0):M=!0;var T=!1;if(M?T=!0:r||"number"==typeof D.$gui.compIdx[I]&&(T=!0),T&&j&&x&&r&&!n){var A="+"+O.$gui.keyid;return void D.setChild("-"+I,function(){h=!0,D.setChild(A,l,function(){var e=D.widget,t=e&&e[I],n=t&&t.component;n&&(v=s.findDOMNode(n)),o&&o(h,v)})})}var R=c.getCompRenewProp(w)||{};if(T)if(j&&(D.props["isScenePage."]||x)){for(var L=D.$gui.removeNum+D.$gui.comps.length,q="auto"+L;"number"==typeof D.$gui.compIdx[q];)q="auto"+(L+=1);R["keyid."]=R.key=q}else R["keyid."]=R.key="";if(_&&(R[_]=N),x?(R.left=0,R.top=0):C&&(R.left=i,R.top=a),f&&(R.left=null,R.top=null),l=c.deepCloneReactEle(l,R,y,w),r&&(M||T||(n?S:$)!==k||(r=!1)),r&&p(s.findDOMNode(b)))return u.instantShow("error: can not remove source widget under a link."),d();h=!0,Object.assign(W,D.$gui.compIdx),n?D.setChild(l,d):D.setChild("+"+O.$gui.keyid,l,d)}function d(){if(h)for(var e,t=Object.keys(D.$gui.compIdx),n=0;e=t[n];n+=1)if(!W.hasOwnProperty(e)&&"$"!=e[0]){var i=D.widget,a=i&&i[e],l=a&&a.component;l&&(v=s.findDOMNode(l));break}h&&r?b.setChild("-"+w.$gui.keyid,function(){o&&o(h,v)}):o&&o(h,v)}var h=!1,v=null,y=f.W(e),w=y&&y.component,k=y&&y.parent,b=k&&k.component;if(!w||!b)return u.instantShow("error: invalid source widget."),d();var S=f.W(t),O=S&&S.component,$=S&&S.parent,P=$&&$.component;if(!O||!P)return u.instantShow("error: invalid target widget."),d();if(r){var E=s.findDOMNode(w);if(E&&"all"!=g(E,1))return u.instantShow("error: move source widget is disallowed."),d()}var N=s.findDOMNode(O);if(N&&"all"!=g(N,n?0:1))return u.instantShow("error: insert target is disallowed."),d();var C=null,_=null,x=w.props["isScenePage."];if(O.props["isScenePage."])C=O,_=S;else if(P.props["isScenePage."])if(n){if(x)return u.instantShow("error: ScenePage can only insert into topmost widget."),d()}else C=P,_=$;var I,W={},D=null,M=w.$gui.isPanel?1:u.hasClass(w,"rewgt-unit")?2:3;if(C){if(_.parent!==m||!m.component)return u.instantShow("error: invalid target ScenePage."),d();if(I=1,S=_,O=C,$=m,P=m.component,x)return r&&w===C?(u.instantShow("warning: ignore moving ScenePage to same place."),d()):(n=!1,l());if(n=!0,1!=M&&2!=M)return u.instantShow("error: only panel, div, paragraph can move to ScenePage."),d()}else{if(x)return u.instantShow("error: ScenePage can only hook to topmost widget."),d();if(I=O.$gui.isPanel?1:u.hasClass(O,"rewgt-unit")?2:3,n){if(3==I&&3!=M)return u.instantShow("error: can not append none-inline to inline widget."),d();if(1==I&&3==M)return u.instantShow("error: can not append inline widget to panel."),d()}else{if(3==I&&3!=M)return u.instantShow("error: can not insert none-inline before inline widget."),d();if(3!=I&&3==M)return u.instantShow("error: can not insert inline before none-inline widget."),d()}}return l()},h.setWdgtZIndex=function(e,t,n){function r(){n&&n(i)}var i=!1,a=e&&f.W(e),o=a&&a.parent;if(a=a&&a.component,o=o&&o.component,!a||!o)return r();if(p(s.findDOMNode(o)))return u.instantShow("error: can not change z-index under a link."),r();var l=Object.assign({},a.state.style);l.zIndex=t+"",a.props.style&&(a.props.style.zIndex=l.zIndex),i=!0,a.setState({style:l},r)},h.getGroupOpt=function(e){var t=e;if("string"==typeof e){var n=f.W(e);t=n&&n.component}return t&&t._?t._._getGroupOpt(t):null};var v=0,y=null,w={},k={};h.widgetSchema=function(e,t,n){var r=e;if("string"==typeof e){var i=f.W(e);r=i&&i.component}if(!r||!r.props)return null;if(!t)return[p=r._._getSchema(r),a(r,p,n)];var o=s.findDOMNode(r),l="all";if(o&&(l=g(o,1)),"none"==l)return[0];var p=r._._getSchema(r),u=a(r,p,n);if(!u)return null;if(!u.properties||u.properties.style||r.props.$style||(u.properties.style={type:"object",propertyOrder:200,default:{}}),k=u.wdgtOption,y=r,w=p,v+=1,delete u.wdgtOption,"some"==l){var d={};(h=Object.keys(u.properties||{})).forEach(function(e){"key"!=e&&"klass"!=e&&"style"!=e&&0!=e.indexOf("data-")&&0!=e.indexOf("aria-")||(d[e]=u.properties[e])}),u.properties=d;var c=u.options||{};c.disable_properties=!0,u.options=c}var h=[],m=[];Object.keys(w).forEach(function(e){var t=w[e];Array.isArray(t)&&m.push([t[0]||0,e])}),m.sort(function(e,t){return e[0]-t[0]}),m.forEach(function(e){h.push(e[1])});var b=k.option.baseUrl||"";return[v,u,{name:k.name,doc:k.doc,flag:k.flag,baseUrl:b},h,r._._htmlText&&!r.props["marked."]]},h.saveWdgtProp=function(e,t,r,i,a){"string"==typeof e&&(e=(e=f.W(e))&&e.component),e&&e.props?n(e,t,r,i,!1,a):a&&a(!1,null)},h.updateWdgtProp=function(e,t,r){v==e&&y?n(y,w,k,t,!0,r):r&&r(!1,null)},h.saveCompStyles=function(e,t,n,r){function i(){r&&setTimeout(function(){var e=g[v];(e=e&&e.component)&&(l=s.findDOMNode(e)),r(a,l)},300)}var a=!1,l=null;if("string"==typeof e&&(e=f.W(e),e=e&&e.component),!e||!e.props)return i();var d=e.widget,g=d&&d.parent,h=g&&g.component,m=null,v=e.$gui.keyid,y="",w="string"==typeof v&&"$"==v[0]?v:"$"+v;if(h){var k=h.$gui.compIdx[v],b=h.$gui.comps;if("number"==typeof k)for(m=b[k++];k<b.length;){var S=b[k++],O=S&&u.keyOfElement(S);if(O&&O!=w){y=O;break}}}if(!m||!t.linkPath)return i();var $=s.findDOMNode(h);if($&&p($))return u.instantShow("error: can not modify widget under a linker."),i();var P=e._._statedProp||[],E=e._._silentProp||[],N=Object.assign({},m.props["link.props"]);P.forEach(function(t){N.hasOwnProperty(t)&&(N[t]=e.state[t])}),E.forEach(function(e){delete N[e]});var C=v+"";"$"!=C[0]&&(C="$"+C),N["keyid."]=N.key=C,N.$=t.linkPath,n?N.styles=n:delete N.styles,m=o.createElement(2==t.flag?c.RefDiv__:c.RefSpan__,N),h.setChild("-"+v,"-"+w,function(e){a=!0,y?h.setChild("+"+y,m,i):h.setChild(m,i)})},h.saveNodeContent=function(e,t,n){function r(){if(n){var e=d[m];(e=e&&e.component)&&(a=s.findDOMNode(e)),n(i,a)}}var i=!1,a=null;if("string"==typeof e&&(e=f.W(e),e=e&&e.component),!e||!e.props)return r();var l=e.widget,d=l&&l.parent,g=d&&d.component,h=null,m=e.$gui.keyid,v="";if(g){var y=g.$gui.compIdx[m],w=g.$gui.comps;if("number"==typeof y){h=w[y++];for(var k="string"==typeof m&&"$"==m[0]?m:"$"+m;y<w.length;){var b=w[y++],S=b&&u.keyOfElement(b);if(S&&S!=k){v=S;break}}}}if(!h)return r();var O=s.findDOMNode(e),$=O&&O.parentNode;if($&&p($))return u.instantShow("error: can not save widget content under a linker."),r();if(O&&0==O.children.length){var P=e.props["link.props"];if(P){var E=c.RefDiv__,N=e.props["data-unit.path"];if(N||(N=e.props["data-span.path"],E=c.RefSpan__),!N)return r();var C=e._._statedProp||[],_=e._._silentProp||[];P=Object.assign({},P),C.forEach(function(t){P.hasOwnProperty(t)&&(P[t]=e.state[t])}),_.forEach(function(e){delete P[e]}),P.$=N,t?P["html."]=t:delete P["html."];var x=m+"";"$"!=x[0]&&(x="$"+x),P.key=P["keyid."]=x,h=o.createElement(E,P),g.setChild("-"+m,"-"+x,function(e){i=!0,v?g.setChild("+"+v,h,r):g.setChild(h,r)})}else{if(!(P=c.getCompRenewProp(e)))return r();P["html."]=t||void 0,P.key=m+"",P["keyid."]=m,h=c.deepCloneReactEle(h,P,l,e),g.setChild("-"+m,function(e){i=!0,v?g.setChild("+"+v,h,r):g.setChild(h,r)})}}else r()},h.onlyScenePage=function(){var e=m,t=0,n=0;return(e=e&&e.component)&&e.$gui.comps.forEach(function(e){var r=e&&u.keyOfElement(e);if(r&&"$pop"!=r){if(e.props["isTemplate."])return;e.props["isScenePage."]?t+=1:n+=1}}),t>0&&0==n},h.selectMultWdgt=function(e,t,n,r,i){function a(e,t,n,r,i,a,o,s){return e<o&&t<s&&n>=i&&r>=a?1:0}function o(e,t,n,r,i,a,o,s){var l=i+o,f=a+s;return i>=e&&a>=t&&l<n&&f<r?1:0}var l=[],f=m&&m[e],p=f&&f.component;if(p&&p.props["isScenePage."]){var d=n>=i&&t>=r,c=Math.min(t,r),g=Math.min(n,i),h=Math.max(t,r),v=Math.max(n,i);p.$gui.comps.forEach(function(e){if(e){var t=u.keyOfElement(e),n=t&&"$"!=t[0]&&f[t];if(n=n&&n.component){var r=s.findDOMNode(n);if(r){var i=r.getBoundingClientRect();if(0==i.width&&0==i.height)return;if(parseInt(r.style.zIndex||0)<=-999)return;d?a(c,g,h,v,i.left,i.top,i.left+i.width,i.top+i.height)&&l.push([t,i.left,i.top,i.width,i.height]):o(c,g,h,v,i.left,i.top,i.width,i.height)&&l.push([t,i.left,i.top,i.width,i.height])}}}})}return l},h.moveSceneWdgt=function(e,t,n){var r=[];if("string"==typeof e){var i=(l=f.W(e))&&l.component;if(i){var a=i.state.left,o=i.state.top;i.setState({left:"number"!=typeof a?null:a+t,top:"number"!=typeof o?null:o+n}),r.push(i.$gui.keyid+"")}}else if(Array.isArray(e)&&e.length>=2){var s=e[0],l=m&&m[s],p=l&&l.component;p&&p.props["isScenePage."]&&e.slice(1).forEach(function(e){var i=l[e],a=i&&i.component;if(a){r.push(e);var o=a.state.left,s=a.state.top;a.setState({left:"number"!=typeof o?null:o+t,top:"number"!=typeof s?null:s+n})}})}return r};h.dumpWidget=function(e,t){var n=!1,r="";try{var i=null,a=",0,";if(Array.isArray(e)){var o=e[0],s=(c=m&&m[o])&&c.component;if(s&&s.props["isScenePage."]){a=",1,",i=[];for(var l,p=1;l=e[p];p+=1){var u=c[l];if(u){var d=[];h.dumpTree(d,u,""),1==d.length&&i.push(d[0])}}0==i.length&&(i=null)}}else if("string"==typeof e&&e){var c=f.W(e);c&&(i=[],h.dumpTree(i,c,""),1!=i.length&&(i=null))}i&&(r="SHADOW_WIDGET_COMPONENT"+a+JSON.stringify(i),n=!0)}catch(e){}!function(){t&&t(n,r)}()},h.pasteWidget=function(e,n,r,i){function a(e){if(r&&c&&c==d)if("string"==typeof r){var t=f.W(r),n=t&&t.component;if(n){var a=t.parent,o=n.$gui.keyid,s=a&&a.component;s&&s.setChild("-"+o)}}else if(Array.isArray(r)){var l=r[0],p=r.slice(1),w=m&&m[l],k=w&&w.component;if(k){var b=p.map(function(e){return"-"+e});b.length&&k.setChild.apply(k,b)}}e&&u.instantShow(e),i&&setTimeout(function(){if(h&&y)for(var e=Object.keys(y.$gui.compIdx),t=e.length-1;t>=0;t--){var n=e[t];if("$"!=n[0]&&h.indexOf(n)<0){var r=y.widget[n];(r=r&&r.component)&&(v=r.getHtmlNode())}}i(c,g,v)},0)}function l(e,t){if(t){var n=S.parent,r=n&&n.component;return!!r&&(e=o.cloneElement(e,{"keyid.":"",key:""}),r.setChild("+"+y.$gui.keyid,e),!0)}var i=e.props["data-unit.path"],a=e.props["data-span.path"],s="",l="string"==typeof i?"data-unit.path":"string"==typeof a?"data-span.path":"";if(l){if(S===m)return u.instantShow("error: can not use linker under topmost widget."),!1;s=a||i}var f=!1,p=u.keyOfElement(e),d=!1;if(p&&"string"==typeof p?(d=0==p.search(/^auto[0-9]+$/))||parseInt(p)+""===p?f=!0:"number"==typeof y.$gui.compIdx[p]&&(f=!0):f=!0,f||l||O){var c={};if(f)if(d&&y.props["isScenePage."]){for(var g=y.$gui.removeNum+y.$gui.comps.length,h="auto"+g;"number"==typeof y.$gui.compIdx[h];)h="auto"+(g+=1);c["keyid."]=c.key=h}else c["keyid."]=c.key="";l&&(c[l]=s),O&&(c.left=e.props.left||0,c.top=e.props.top||0),e=o.cloneElement(e,c)}return O?y.setChild(e):y.setChild("+"+b.$gui.keyid,e),!0}var d=0,c=0,g=!0,h=null,v=null,y=null,w=null;if(0!=n.indexOf("SHADOW_WIDGET_COMPONENT")||"["==n["SHADOW_WIDGET_COMPONENT".length+3])try{w=JSON.parse(n.slice("SHADOW_WIDGET_COMPONENT".length+3))}catch(e){}if(!Array.isArray(w))return a("paste failed: invalid JSON input.");var k=f.W(e),b=k&&k.component;if(!b)return a();var S=null,O=b.props["isScenePage."];if(O)S=k,y=b,k=null,b=null;else{if(S=k.parent,!(y=S&&S.component))return a();y.props["isScenePage."]&&(O=!0)}"absolute"==(y.state.style||{}).position&&(g=!0);var $=[],P=!1;if(w.forEach(function(e){var t=u.loadElement(e);t?$.push(t):P=!0}),P)return a("paste failed: invalid format.");if(0==(d=$.length))return a("nothing to paste.");1==d&&O&&(h=Object.keys(y.$gui.compIdx));var E=0,N=!1;if(!O){if(p(s.findDOMNode(y)))return u.instantShow("error: can not paste widget to a linker."),a();1!=d&&(u.instantShow("warning: only one widget can be inserted into none-ScenePage."),$.splice(1),d=1),1==(E=y.$gui.isPanel||S===m?0:u.hasClass(y,"rewgt-unit")?1:3)&&y.props["childInline."]&&(E=2),1==E&&tarNodeObj.props["isTableRow."]&&(N=!0)}for(var C,_=0;C=$[_];_+=1)if(C.props["isScenePage."]){if(!O)return u.instantShow("error: ScenePage can only insert into topmost widget."),a();if(g=!0,!l(C,!0))return a();c+=1}else{var x=" "+C.props.className+" ",I=x.indexOf(" rewgt-panel ")>=0?0:x.indexOf(" rewgt-unit ")>=0?1:3;if(1==I&&C.props["childInline."]&&(I=2),!t(I,E,N))return a();if(!l(C,!1))return a();c+=1}setTimeout(function(){a()},0)},h.firstChildOf=function(e,t){var n=f.W(e),r=n&&n.component;if(r)for(var i=r.$gui.comps,a=i.length,o=0;o<a;o+=1){var l=i[o],p=l&&u.keyOfElement(l);if(p){if(t&&"$"==p[0])continue;var d=n[p],c=d&&d.component;if(c)return s.findDOMNode(c)}}return null},e()})});